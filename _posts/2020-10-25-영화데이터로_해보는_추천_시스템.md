---
title: 영화데이터로 해보는 추천 시스템(Recommendations)
author: HyunMin Kim
date: 2020-10-25 09:00:00 0000
categories: [Data Science, Machine Learning]
tags: [Recommendations, Content Based Filtering, Collaborative Filtering]
---

## 1. 추천 시스템
---
### 1.1 추천 시스템

<img src="https://user-images.githubusercontent.com/60168331/97109867-16daee80-1719-11eb-882e-b9f736a1f188.png">

- 요즘 유튜브, 멜론 등등에는 추천 시스템이 적용되어 있음
- 특히 온라인 쇼핑몰 컨텐츠 등에서도 중요한 부분을 차지함
- 추천시스템은 콘텐츠 기반 필터링과 협업 필터링, 크개 2가지로 나뉜다.

<br>

### 1.2 콘텐츠 기반 필터링 추천 시스템
- 사용자가 특정한 아이템을 선호하는 경우 그 아이템과 비슷한 아이템을 추천하는 방식

<br>

### 1.3 최근접 이웃 협업 필터링
- 축적된 사용자 행동 데이터를 기반으로 사용자가 아직 평가하지 않은 아이템을 예측 평하
- 사용자 기반 : 당신과 비슷한 고객들이 다음 상품도 구매함
- 아이템 기반 : 이 상품을 선택한 다른 고객들은 다음 상품도 구매함
- 일반적으로는 사용자 기반 보다는 아이템기반 협업 필터링이 정확도가 더 높음
    - 비슷한 영화를 좋아한다고 취향이 비슷하다고 판단하기 어려움
    - 매우 유명한 영화는 취향과 관계없이 관람하는 경우가 많음
    - 사용자들이 평점을 매기지 않는 경우가 많음
    
<br>

### 1.4 잠재 요인 협업 필터링

<img src="https://user-images.githubusercontent.com/60168331/97107281-12f3a000-170a-11eb-9514-b20586241852.png">

- 사용자 - 아이템 평점 행렬 데이터를 이용해서 잠재요인을 도출하는 것
- 주요인과 아이템에 대한 잠재요인에 대해 행렬분해를 하고 다시 행렬곱을 통해 아직 평점을 부여하지 않은 아이템에 대한 예측 평점을 생성

<br>

## 2. 콘텐츠 기반 필터링 실습
---
### 2.1 TMDB5000 영화 데이터 세트

<https://www.kaggle.com/tmdb/tmdb-movie-metadata>{:target="_blank"}
- kaggle에 있는 TMDB5000 영화 데이터 세트
- 4803개의 영화 정보가 들어 있음

<br>

### 2.2 데이터 로드


```python
import pandas as pd
import numpy as np

movies = pd.read_csv('https://media.githubusercontent.com/media/hmkim312/datas/main/tmdb5000/tmdb_5000_movies.csv')
print(movies.shape)
movies.head()
```

    (4803, 20)



<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>budget</th>
      <th>genres</th>
      <th>homepage</th>
      <th>id</th>
      <th>keywords</th>
      <th>original_language</th>
      <th>original_title</th>
      <th>overview</th>
      <th>popularity</th>
      <th>production_companies</th>
      <th>production_countries</th>
      <th>release_date</th>
      <th>revenue</th>
      <th>runtime</th>
      <th>spoken_languages</th>
      <th>status</th>
      <th>tagline</th>
      <th>title</th>
      <th>vote_average</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>237000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "nam...</td>
      <td>http://www.avatarmovie.com/</td>
      <td>19995</td>
      <td>[{"id": 1463, "name": "culture clash"}, {"id":...</td>
      <td>en</td>
      <td>Avatar</td>
      <td>In the 22nd century, a paraplegic Marine is di...</td>
      <td>150.437577</td>
      <td>[{"name": "Ingenious Film Partners", "id": 289...</td>
      <td>[{"iso_3166_1": "US", "name": "United States o...</td>
      <td>2009-12-10</td>
      <td>2787965087</td>
      <td>162.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}, {"iso...</td>
      <td>Released</td>
      <td>Enter the World of Pandora.</td>
      <td>Avatar</td>
      <td>7.2</td>
      <td>11800</td>
    </tr>
    <tr>
      <th>1</th>
      <td>300000000</td>
      <td>[{"id": 12, "name": "Adventure"}, {"id": 14, "...</td>
      <td>http://disney.go.com/disneypictures/pirates/</td>
      <td>285</td>
      <td>[{"id": 270, "name": "ocean"}, {"id": 726, "na...</td>
      <td>en</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>Captain Barbossa, long believed to be dead, ha...</td>
      <td>139.082615</td>
      <td>[{"name": "Walt Disney Pictures", "id": 2}, {"...</td>
      <td>[{"iso_3166_1": "US", "name": "United States o...</td>
      <td>2007-05-19</td>
      <td>961000000</td>
      <td>169.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}]</td>
      <td>Released</td>
      <td>At the end of the world, the adventure begins.</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>6.9</td>
      <td>4500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>245000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "nam...</td>
      <td>http://www.sonypictures.com/movies/spectre/</td>
      <td>206647</td>
      <td>[{"id": 470, "name": "spy"}, {"id": 818, "name...</td>
      <td>en</td>
      <td>Spectre</td>
      <td>A cryptic message from Bond’s past sends him o...</td>
      <td>107.376788</td>
      <td>[{"name": "Columbia Pictures", "id": 5}, {"nam...</td>
      <td>[{"iso_3166_1": "GB", "name": "United Kingdom"...</td>
      <td>2015-10-26</td>
      <td>880674609</td>
      <td>148.0</td>
      <td>[{"iso_639_1": "fr", "name": "Fran\u00e7ais"},...</td>
      <td>Released</td>
      <td>A Plan No One Escapes</td>
      <td>Spectre</td>
      <td>6.3</td>
      <td>4466</td>
    </tr>
    <tr>
      <th>3</th>
      <td>250000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 80, "nam...</td>
      <td>http://www.thedarkknightrises.com/</td>
      <td>49026</td>
      <td>[{"id": 849, "name": "dc comics"}, {"id": 853,...</td>
      <td>en</td>
      <td>The Dark Knight Rises</td>
      <td>Following the death of District Attorney Harve...</td>
      <td>112.312950</td>
      <td>[{"name": "Legendary Pictures", "id": 923}, {"...</td>
      <td>[{"iso_3166_1": "US", "name": "United States o...</td>
      <td>2012-07-16</td>
      <td>1084939099</td>
      <td>165.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}]</td>
      <td>Released</td>
      <td>The Legend Ends</td>
      <td>The Dark Knight Rises</td>
      <td>7.6</td>
      <td>9106</td>
    </tr>
    <tr>
      <th>4</th>
      <td>260000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "nam...</td>
      <td>http://movies.disney.com/john-carter</td>
      <td>49529</td>
      <td>[{"id": 818, "name": "based on novel"}, {"id":...</td>
      <td>en</td>
      <td>John Carter</td>
      <td>John Carter is a war-weary, former military ca...</td>
      <td>43.926995</td>
      <td>[{"name": "Walt Disney Pictures", "id": 2}]</td>
      <td>[{"iso_3166_1": "US", "name": "United States o...</td>
      <td>2012-03-07</td>
      <td>284139100</td>
      <td>132.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}]</td>
      <td>Released</td>
      <td>Lost in our world, found in another.</td>
      <td>John Carter</td>
      <td>6.1</td>
      <td>2124</td>
    </tr>
  </tbody>
</table>
</div>



<br>

### 2.3 데이터 선택


```python
movies_df = movies[['id', 'title', 'genres', 'vote_average',
                    'vote_count', 'popularity', 'keywords', 'overview']]
movies_df.head()
```


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>genres</th>
      <th>vote_average</th>
      <th>vote_count</th>
      <th>popularity</th>
      <th>keywords</th>
      <th>overview</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19995</td>
      <td>Avatar</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "nam...</td>
      <td>7.2</td>
      <td>11800</td>
      <td>150.437577</td>
      <td>[{"id": 1463, "name": "culture clash"}, {"id":...</td>
      <td>In the 22nd century, a paraplegic Marine is di...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>285</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>[{"id": 12, "name": "Adventure"}, {"id": 14, "...</td>
      <td>6.9</td>
      <td>4500</td>
      <td>139.082615</td>
      <td>[{"id": 270, "name": "ocean"}, {"id": 726, "na...</td>
      <td>Captain Barbossa, long believed to be dead, ha...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>206647</td>
      <td>Spectre</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "nam...</td>
      <td>6.3</td>
      <td>4466</td>
      <td>107.376788</td>
      <td>[{"id": 470, "name": "spy"}, {"id": 818, "name...</td>
      <td>A cryptic message from Bond’s past sends him o...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>49026</td>
      <td>The Dark Knight Rises</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 80, "nam...</td>
      <td>7.6</td>
      <td>9106</td>
      <td>112.312950</td>
      <td>[{"id": 849, "name": "dc comics"}, {"id": 853,...</td>
      <td>Following the death of District Attorney Harve...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>49529</td>
      <td>John Carter</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "nam...</td>
      <td>6.1</td>
      <td>2124</td>
      <td>43.926995</td>
      <td>[{"id": 818, "name": "based on novel"}, {"id":...</td>
      <td>John Carter is a war-weary, former military ca...</td>
    </tr>
  </tbody>
</table>
</div>



- 실습에 필요한 컬럼만 가져옴
- id : unique한 id
- title : 영화제목
- genres : 영화 장르
- vote_average : 평균 평점
- vote_count : 투표수
- popularity : 인기점수
- keywords : 키워드
- overview : 영화 개요

<br>

### 2.4 데이터 주의 사항


```python
movies_df[['genres']][:1].values
```




    array([['[{"id": 28, "name": "Action"}, {"id": 12, "name": "Adventure"}, {"id": 14, "name": "Fantasy"}, {"id": 878, "name": "Science Fiction"}]']],
          dtype=object)



- genres와 keywords는 컬럼안에 dict형으로 저장되어 있음

<br>

### 2.5 문자열로 된 데이터


```python
from ast import literal_eval

code = """(1,2, {'foo', 'bar'})"""
code, type(code)
```




    ("(1,2, {'foo', 'bar'})", str)



- genres와 keywords는 str로 되어 있음

<br>


```python
literal_eval(code), type(literal_eval(code))
```




    ((1, 2, {'bar', 'foo'}), tuple)



- literal_eval을 사용하여 tuple형태로 변경함

<br>

### 2.6 genresdhk keywords의 내용을 list와 dict으로 복구


```python
from ast import literal_eval
import warnings; warnings.filterwarnings('ignore')

movies_df['genres'] = movies_df['genres'].apply(literal_eval)
movies_df['keywords'] = movies_df['keywords'].apply(literal_eval)
movies_df
```


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>genres</th>
      <th>vote_average</th>
      <th>vote_count</th>
      <th>popularity</th>
      <th>keywords</th>
      <th>overview</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19995</td>
      <td>Avatar</td>
      <td>[{'id': 28, 'name': 'Action'}, {'id': 12, 'nam...</td>
      <td>7.2</td>
      <td>11800</td>
      <td>150.437577</td>
      <td>[{'id': 1463, 'name': 'culture clash'}, {'id':...</td>
      <td>In the 22nd century, a paraplegic Marine is di...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>285</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>[{'id': 12, 'name': 'Adventure'}, {'id': 14, '...</td>
      <td>6.9</td>
      <td>4500</td>
      <td>139.082615</td>
      <td>[{'id': 270, 'name': 'ocean'}, {'id': 726, 'na...</td>
      <td>Captain Barbossa, long believed to be dead, ha...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>206647</td>
      <td>Spectre</td>
      <td>[{'id': 28, 'name': 'Action'}, {'id': 12, 'nam...</td>
      <td>6.3</td>
      <td>4466</td>
      <td>107.376788</td>
      <td>[{'id': 470, 'name': 'spy'}, {'id': 818, 'name...</td>
      <td>A cryptic message from Bond’s past sends him o...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>49026</td>
      <td>The Dark Knight Rises</td>
      <td>[{'id': 28, 'name': 'Action'}, {'id': 80, 'nam...</td>
      <td>7.6</td>
      <td>9106</td>
      <td>112.312950</td>
      <td>[{'id': 849, 'name': 'dc comics'}, {'id': 853,...</td>
      <td>Following the death of District Attorney Harve...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>49529</td>
      <td>John Carter</td>
      <td>[{'id': 28, 'name': 'Action'}, {'id': 12, 'nam...</td>
      <td>6.1</td>
      <td>2124</td>
      <td>43.926995</td>
      <td>[{'id': 818, 'name': 'based on novel'}, {'id':...</td>
      <td>John Carter is a war-weary, former military ca...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4798</th>
      <td>9367</td>
      <td>El Mariachi</td>
      <td>[{'id': 28, 'name': 'Action'}, {'id': 80, 'nam...</td>
      <td>6.6</td>
      <td>238</td>
      <td>14.269792</td>
      <td>[{'id': 5616, 'name': 'united states–mexico ba...</td>
      <td>El Mariachi just wants to play his guitar and ...</td>
    </tr>
    <tr>
      <th>4799</th>
      <td>72766</td>
      <td>Newlyweds</td>
      <td>[{'id': 35, 'name': 'Comedy'}, {'id': 10749, '...</td>
      <td>5.9</td>
      <td>5</td>
      <td>0.642552</td>
      <td>[]</td>
      <td>A newlywed couple's honeymoon is upended by th...</td>
    </tr>
    <tr>
      <th>4800</th>
      <td>231617</td>
      <td>Signed, Sealed, Delivered</td>
      <td>[{'id': 35, 'name': 'Comedy'}, {'id': 18, 'nam...</td>
      <td>7.0</td>
      <td>6</td>
      <td>1.444476</td>
      <td>[{'id': 248, 'name': 'date'}, {'id': 699, 'nam...</td>
      <td>"Signed, Sealed, Delivered" introduces a dedic...</td>
    </tr>
    <tr>
      <th>4801</th>
      <td>126186</td>
      <td>Shanghai Calling</td>
      <td>[]</td>
      <td>5.7</td>
      <td>7</td>
      <td>0.857008</td>
      <td>[]</td>
      <td>When ambitious New York attorney Sam is sent t...</td>
    </tr>
    <tr>
      <th>4802</th>
      <td>25975</td>
      <td>My Date with Drew</td>
      <td>[{'id': 99, 'name': 'Documentary'}]</td>
      <td>6.3</td>
      <td>16</td>
      <td>1.929883</td>
      <td>[{'id': 1523, 'name': 'obsession'}, {'id': 224...</td>
      <td>Ever since the second grade when he first saw ...</td>
    </tr>
  </tbody>
</table>
<p>4803 rows × 8 columns</p>
</div>



- literal_eval을 사용하여 keywords와 genres를 list안에 dict으로 변경함

<br>

### 2.7 dict의 value값을 특성으로 사용하도록 변경


```python
movies_df['genres'] = movies_df['genres'].apply(lambda x : [y['name'] for y in x])
movies_df['keywords'] = movies_df['keywords'].apply(lambda x : [y['name'] for y in x])
movies_df[['genres', 'keywords']][:2]
```



<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>genres</th>
      <th>keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[Action, Adventure, Fantasy, Science Fiction]</td>
      <td>[culture clash, future, space war, space colon...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[Adventure, Fantasy, Action]</td>
      <td>[ocean, drug abuse, exotic island, east india ...</td>
    </tr>
  </tbody>
</table>
</div>



- dict 형태의 key : value로 들어있던 내용을, value값을 특성으로 사용하도록 for문과 lambda를 사용하여 해결

<br>

### 2.8 genres의 각 단어들을 하나의 문장으로 변환


```python
movies_df['genres_literal'] = movies_df['genres'].apply(lambda x : (' ').join(x))
movies_df.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>genres</th>
      <th>vote_average</th>
      <th>vote_count</th>
      <th>popularity</th>
      <th>keywords</th>
      <th>overview</th>
      <th>genres_literal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19995</td>
      <td>Avatar</td>
      <td>[Action, Adventure, Fantasy, Science Fiction]</td>
      <td>7.2</td>
      <td>11800</td>
      <td>150.437577</td>
      <td>[culture clash, future, space war, space colon...</td>
      <td>In the 22nd century, a paraplegic Marine is di...</td>
      <td>Action Adventure Fantasy Science Fiction</td>
    </tr>
    <tr>
      <th>1</th>
      <td>285</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>[Adventure, Fantasy, Action]</td>
      <td>6.9</td>
      <td>4500</td>
      <td>139.082615</td>
      <td>[ocean, drug abuse, exotic island, east india ...</td>
      <td>Captain Barbossa, long believed to be dead, ha...</td>
      <td>Adventure Fantasy Action</td>
    </tr>
    <tr>
      <th>2</th>
      <td>206647</td>
      <td>Spectre</td>
      <td>[Action, Adventure, Crime]</td>
      <td>6.3</td>
      <td>4466</td>
      <td>107.376788</td>
      <td>[spy, based on novel, secret agent, sequel, mi...</td>
      <td>A cryptic message from Bond’s past sends him o...</td>
      <td>Action Adventure Crime</td>
    </tr>
    <tr>
      <th>3</th>
      <td>49026</td>
      <td>The Dark Knight Rises</td>
      <td>[Action, Crime, Drama, Thriller]</td>
      <td>7.6</td>
      <td>9106</td>
      <td>112.312950</td>
      <td>[dc comics, crime fighter, terrorist, secret i...</td>
      <td>Following the death of District Attorney Harve...</td>
      <td>Action Crime Drama Thriller</td>
    </tr>
    <tr>
      <th>4</th>
      <td>49529</td>
      <td>John Carter</td>
      <td>[Action, Adventure, Science Fiction]</td>
      <td>6.1</td>
      <td>2124</td>
      <td>43.926995</td>
      <td>[based on novel, mars, medallion, space travel...</td>
      <td>John Carter is a war-weary, former military ca...</td>
      <td>Action Adventure Science Fiction</td>
    </tr>
  </tbody>
</table>
</div>



- join을 사용하여 list로 되어있는 genres를 띄어쓰기로 된 컬럼을 생성

<br>

### 2.9 genres를 countvectorize


```python
from sklearn.feature_extraction.text import CountVectorizer

count_vect = CountVectorizer(min_df=0, ngram_range=(1, 2))
genre_mat = count_vect.fit_transform(movies_df['genres_literal'])
print(genre_mat.shape)
```

    (4803, 276)


- countvectorize를 하여 4803개의 영화에서 276개의 말뭉치 단어가 생김

<br>

### 2.10 코사인 유사도


```python
from sklearn.metrics.pairwise import cosine_similarity

genre_sim = cosine_similarity(genre_mat, genre_mat)
print(genre_sim.shape)
print(genre_sim[:2])
```

    (4803, 4803)
    [[1.         0.59628479 0.4472136  ... 0.         0.         0.        ]
     [0.59628479 1.         0.4        ... 0.         0.         0.        ]]


<img src="https://user-images.githubusercontent.com/60168331/97108313-14c06200-1710-11eb-8f85-30acec617b6c.png">

- 코사인 유사도를 통해, 아이템별로 비슷한 점수를 알수 있음

<br>

### 2.11 genre_sim 높은값 순으로 정렬


```python
genre_sim_sorted_ind = genre_sim.argsort()[:, ::-1]
print(genre_sim_sorted_ind[:1])
```

    [[   0 3494  813 ... 3038 3037 2401]]


<br>

### 2.12 추천 영화를 DataFrame으로 반환하는 함수 생성



```python
def find_sim_movie(df, sorted_ind, title_name, top_n = 10):
    title_movie = df[df['title'] == title_name]
    
    title_index = title_movie.index.values
    similar_indexes = sorted_ind[title_index, :(top_n)]
    
    print(similar_indexes)
    similar_indexes = similar_indexes.reshape(-1)
    
    return df.iloc[similar_indexes]
```

<br>

### 2.13 비슷한 영화 찾기


```python
similar_movies = find_sim_movie(movies_df, genre_sim_sorted_ind, 'The Godfather', 10)
similar_movies[['title', 'vote_average']]
```

    [[2731 1243 3636 1946 2640 4065 1847 4217  883 3866]]


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2731</th>
      <td>The Godfather: Part II</td>
      <td>8.3</td>
    </tr>
    <tr>
      <th>1243</th>
      <td>Mean Streets</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>3636</th>
      <td>Light Sleeper</td>
      <td>5.7</td>
    </tr>
    <tr>
      <th>1946</th>
      <td>The Bad Lieutenant: Port of Call - New Orleans</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>2640</th>
      <td>Things to Do in Denver When You're Dead</td>
      <td>6.7</td>
    </tr>
    <tr>
      <th>4065</th>
      <td>Mi America</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1847</th>
      <td>GoodFellas</td>
      <td>8.2</td>
    </tr>
    <tr>
      <th>4217</th>
      <td>Kids</td>
      <td>6.8</td>
    </tr>
    <tr>
      <th>883</th>
      <td>Catch Me If You Can</td>
      <td>7.7</td>
    </tr>
    <tr>
      <th>3866</th>
      <td>City of God</td>
      <td>8.1</td>
    </tr>
  </tbody>
</table>
</div>



- 대부2는 맞는거 같은데 그 아래는 좀..
- 문제가 있는듯 하다

<br>

### 2.14 vote_average 확인


```python
movies_df[['title', 'vote_average', 'vote_count']].sort_values('vote_average', ascending = False)[:10]
```


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3519</th>
      <td>Stiff Upper Lips</td>
      <td>10.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4247</th>
      <td>Me You and Five Bucks</td>
      <td>10.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4045</th>
      <td>Dancer, Texas Pop. 81</td>
      <td>10.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4662</th>
      <td>Little Big Top</td>
      <td>10.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3992</th>
      <td>Sardaarji</td>
      <td>9.5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2386</th>
      <td>One Man's Hero</td>
      <td>9.3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2970</th>
      <td>There Goes My Baby</td>
      <td>8.5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>The Shawshank Redemption</td>
      <td>8.5</td>
      <td>8205</td>
    </tr>
    <tr>
      <th>2796</th>
      <td>The Prisoner of Zenda</td>
      <td>8.4</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3337</th>
      <td>The Godfather</td>
      <td>8.4</td>
      <td>5893</td>
    </tr>
  </tbody>
</table>
</div>



- 평점과 평점을 매긴 횟수를 보면 문제 데이터가 보임
- 평점은 10점이나 횟수는 1점 등등..

<br>

### 2.15 영화 선정을 위한 가중치 선정

<img src="https://user-images.githubusercontent.com/60168331/97108663-5c47ed80-1712-11eb-89f9-e0c42828c698.png">

- v : 개별 영화에 평점을 투표한 횟수
- m : 평점을 부여하기 위한 최소 투표 횟수
- R : 개별 영화에 대한 평균 평점
- C : 전체 영화에 대한 평균 평점

<br>

### 2.16 영화 전체 평균 평점과 최소 투표횟수를 60%로 지정


```python
C = movies_df['vote_average'].mean()
m = movies_df['vote_count'].quantile(0.6)
print('C:', round(C, 3), 'm:', round(m,3))
```

    C: 6.092 m: 370.2


- 영화의 평균 평점은 6점정도이고, 최소 투표회수 60%지점은 약 370회
- 370회 미만의 평점 투표 영화는 제외 됨

<br>

### 2.17 가중치가 부여된 평점을 계산하기 위한 함수 생성


```python
def weighted_vote_average(record):
    v = record['vote_count']
    R = record['vote_average']
    
    return ((v/(v+m)) * R) + ((m/(m+v))*C)
```

- 위의 가중치 계산식을 함수로 작성

<br>

### 2.18 다시 계산


```python
movies_df['weighted_vote'] = movies_df.apply(weighted_vote_average, axis = 1)
movies_df.head()
```

<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>title</th>
      <th>genres</th>
      <th>vote_average</th>
      <th>vote_count</th>
      <th>popularity</th>
      <th>keywords</th>
      <th>overview</th>
      <th>genres_literal</th>
      <th>weighted_vote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19995</td>
      <td>Avatar</td>
      <td>[Action, Adventure, Fantasy, Science Fiction]</td>
      <td>7.2</td>
      <td>11800</td>
      <td>150.437577</td>
      <td>[culture clash, future, space war, space colon...</td>
      <td>In the 22nd century, a paraplegic Marine is di...</td>
      <td>Action Adventure Fantasy Science Fiction</td>
      <td>7.166301</td>
    </tr>
    <tr>
      <th>1</th>
      <td>285</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>[Adventure, Fantasy, Action]</td>
      <td>6.9</td>
      <td>4500</td>
      <td>139.082615</td>
      <td>[ocean, drug abuse, exotic island, east india ...</td>
      <td>Captain Barbossa, long believed to be dead, ha...</td>
      <td>Adventure Fantasy Action</td>
      <td>6.838594</td>
    </tr>
    <tr>
      <th>2</th>
      <td>206647</td>
      <td>Spectre</td>
      <td>[Action, Adventure, Crime]</td>
      <td>6.3</td>
      <td>4466</td>
      <td>107.376788</td>
      <td>[spy, based on novel, secret agent, sequel, mi...</td>
      <td>A cryptic message from Bond’s past sends him o...</td>
      <td>Action Adventure Crime</td>
      <td>6.284091</td>
    </tr>
    <tr>
      <th>3</th>
      <td>49026</td>
      <td>The Dark Knight Rises</td>
      <td>[Action, Crime, Drama, Thriller]</td>
      <td>7.6</td>
      <td>9106</td>
      <td>112.312950</td>
      <td>[dc comics, crime fighter, terrorist, secret i...</td>
      <td>Following the death of District Attorney Harve...</td>
      <td>Action Crime Drama Thriller</td>
      <td>7.541095</td>
    </tr>
    <tr>
      <th>4</th>
      <td>49529</td>
      <td>John Carter</td>
      <td>[Action, Adventure, Science Fiction]</td>
      <td>6.1</td>
      <td>2124</td>
      <td>43.926995</td>
      <td>[based on novel, mars, medallion, space travel...</td>
      <td>John Carter is a war-weary, former military ca...</td>
      <td>Action Adventure Science Fiction</td>
      <td>6.098838</td>
    </tr>
  </tbody>
</table>
</div>



- 전체 데이터에 함수 적용

<br>

### 2.19 가중치 부여된 평점 순으로 정렬


```python
movies_df[['title', 'vote_average', 'weighted_vote', 'vote_count']].sort_values('weighted_vote', ascending = False)[:10]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
      <th>weighted_vote</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1881</th>
      <td>The Shawshank Redemption</td>
      <td>8.5</td>
      <td>8.396052</td>
      <td>8205</td>
    </tr>
    <tr>
      <th>3337</th>
      <td>The Godfather</td>
      <td>8.4</td>
      <td>8.263591</td>
      <td>5893</td>
    </tr>
    <tr>
      <th>662</th>
      <td>Fight Club</td>
      <td>8.3</td>
      <td>8.216455</td>
      <td>9413</td>
    </tr>
    <tr>
      <th>3232</th>
      <td>Pulp Fiction</td>
      <td>8.3</td>
      <td>8.207102</td>
      <td>8428</td>
    </tr>
    <tr>
      <th>65</th>
      <td>The Dark Knight</td>
      <td>8.2</td>
      <td>8.136930</td>
      <td>12002</td>
    </tr>
    <tr>
      <th>1818</th>
      <td>Schindler's List</td>
      <td>8.3</td>
      <td>8.126069</td>
      <td>4329</td>
    </tr>
    <tr>
      <th>3865</th>
      <td>Whiplash</td>
      <td>8.3</td>
      <td>8.123248</td>
      <td>4254</td>
    </tr>
    <tr>
      <th>809</th>
      <td>Forrest Gump</td>
      <td>8.2</td>
      <td>8.105954</td>
      <td>7927</td>
    </tr>
    <tr>
      <th>2294</th>
      <td>Spirited Away</td>
      <td>8.3</td>
      <td>8.105867</td>
      <td>3840</td>
    </tr>
    <tr>
      <th>2731</th>
      <td>The Godfather: Part II</td>
      <td>8.3</td>
      <td>8.079586</td>
      <td>3338</td>
    </tr>
  </tbody>
</table>
</div>



- 평점이 8.39 이상, 투표한 횟수가 적은 영화는 제외됨

<br>

### 2.20 유사 영화 찾는 함수 변경


```python
def find_sim_movie(df, sorted_ind, title_name, top_n = 10):
    title_movie = df[df['title'] == title_name]
    title_index = title_movie.index.values
    
    similar_indexes = sorted_ind[title_index, :(top_n*2)]
    similar_indexes = similar_indexes.reshape(-1)
    
    similar_indexes = similar_indexes[similar_indexes != title_index]
    
    return df.iloc[similar_indexes].sort_values('weighted_vote', ascending =False)[:top_n]
```

- 이전에 작성한 함수에서, 가중치를 부여한 평점을 추가함

<br>

### 2.21 대부와 유사한 영화 찾기


```python
similar_movies = find_sim_movie(movies_df, genre_sim_sorted_ind, 'The Godfather', 10)
similar_movies[['title', 'vote_average', 'weighted_vote']]
```

<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
      <th>weighted_vote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2731</th>
      <td>The Godfather: Part II</td>
      <td>8.3</td>
      <td>8.079586</td>
    </tr>
    <tr>
      <th>1847</th>
      <td>GoodFellas</td>
      <td>8.2</td>
      <td>7.976937</td>
    </tr>
    <tr>
      <th>3866</th>
      <td>City of God</td>
      <td>8.1</td>
      <td>7.759693</td>
    </tr>
    <tr>
      <th>1663</th>
      <td>Once Upon a Time in America</td>
      <td>8.2</td>
      <td>7.657811</td>
    </tr>
    <tr>
      <th>883</th>
      <td>Catch Me If You Can</td>
      <td>7.7</td>
      <td>7.557097</td>
    </tr>
    <tr>
      <th>281</th>
      <td>American Gangster</td>
      <td>7.4</td>
      <td>7.141396</td>
    </tr>
    <tr>
      <th>4041</th>
      <td>This Is England</td>
      <td>7.4</td>
      <td>6.739664</td>
    </tr>
    <tr>
      <th>1149</th>
      <td>American Hustle</td>
      <td>6.8</td>
      <td>6.717525</td>
    </tr>
    <tr>
      <th>1243</th>
      <td>Mean Streets</td>
      <td>7.2</td>
      <td>6.626569</td>
    </tr>
    <tr>
      <th>2839</th>
      <td>Rounders</td>
      <td>6.9</td>
      <td>6.530427</td>
    </tr>
  </tbody>
</table>
</div>



- 아까보다는 좀 나은듯 하다. 가중치륿 부여해서 그런듯

<br>

## 3. 아이템 기반 최근접 이웃 협업 필터링
---
### 3.1 무비렌즈 데이터

<https://grouplens.org/datasets/movielens/latest/>{:target="_blank"}
- 영화의 평점을 매긴 사용자와 영화 평점 행렬 등의 데이터
- 1메가짜리 small 데이터 다운

<br>

### 3.2 데이터 불러오기


```python
import pandas as pd
import numpy as np

movies = pd.read_csv('https://media.githubusercontent.com/media/hmkim312/datas/main/ml-latest-small/movies.csv')
ratings = pd.read_csv('https://media.githubusercontent.com/media/hmkim312/datas/main/ml-latest-small/ratings.csv')

print(movies.shape)
print(ratings.shape)
```

    (9742, 3)
    (100836, 4)


<br>


```python
movies.head()
```

<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
    </tr>
  </tbody>
</table>
</div>



<br>


```python
ratings.head()
```

<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>964982703</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
      <td>964981247</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
      <td>964982224</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
      <td>964983815</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
      <td>964982931</td>
    </tr>
  </tbody>
</table>
</div>



- movie 데이터는 9742개로 영화 제목과 장르가 있음
- ratings 데이터는 100836개로 영화 평점이 사용자별로 존재함

<br>

<img src="https://user-images.githubusercontent.com/60168331/97109307-e47bc200-1715-11eb-8956-067d54a470f1.png">

- raw_data2개를 위 사진처럼 정리 해야함

<br>

### 3.3 피벗테이블


```python
ratings = ratings[['userId', 'movieId', 'rating']]
ratings_matrix = ratings.pivot_table('rating', index = 'userId', columns = 'movieId')
ratings_matrix.head()
```

<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>movieId</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>...</th>
      <th>193565</th>
      <th>193567</th>
      <th>193571</th>
      <th>193573</th>
      <th>193579</th>
      <th>193581</th>
      <th>193583</th>
      <th>193585</th>
      <th>193587</th>
      <th>193609</th>
    </tr>
    <tr>
      <th>userId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 9724 columns</p>
</div>



- 유저별 영화의 평점은 만들었다.
- 영화 이름이 id로 되어있어서 알수 없으니, movie 데이터에서 합치기

<br>

### 3.4 ratings와 movie를 movieId로 결합


```python
rating_movies = pd.merge(ratings, movies, on = 'movieId')
rating_movies.head()
```


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5</td>
      <td>1</td>
      <td>4.0</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7</td>
      <td>1</td>
      <td>4.5</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>3</th>
      <td>15</td>
      <td>1</td>
      <td>2.5</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17</td>
      <td>1</td>
      <td>4.5</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
  </tbody>
</table>
</div>



- rating에 title을 붙였으니, 다시 정리

<br>

### 3.5 피벗테이블2


```python
ratings = ratings[['userId', 'movieId', 'rating']]
ratings_matrix = rating_movies.pivot_table('rating', index = 'userId', columns = 'title')
ratings_matrix.head()
```



<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>title</th>
      <th>'71 (2014)</th>
      <th>'Hellboy': The Seeds of Creation (2004)</th>
      <th>'Round Midnight (1986)</th>
      <th>'Salem's Lot (2004)</th>
      <th>'Til There Was You (1997)</th>
      <th>'Tis the Season for Love (2015)</th>
      <th>'burbs, The (1989)</th>
      <th>'night Mother (1986)</th>
      <th>(500) Days of Summer (2009)</th>
      <th>*batteries not included (1987)</th>
      <th>...</th>
      <th>Zulu (2013)</th>
      <th>[REC] (2007)</th>
      <th>[REC]² (2009)</th>
      <th>[REC]³ 3 Génesis (2012)</th>
      <th>anohana: The Flower We Saw That Day - The Movie (2013)</th>
      <th>eXistenZ (1999)</th>
      <th>xXx (2002)</th>
      <th>xXx: State of the Union (2005)</th>
      <th>¡Three Amigos! (1986)</th>
      <th>À nous la liberté (Freedom for Us) (1931)</th>
    </tr>
    <tr>
      <th>userId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 9719 columns</p>
</div>



- 이제는 유저가 영화에 점수를 준것을 정리함
- 단 NaN데이터가 있음

<br>

### 3.6 NaN 데이터 처리


```python
ratings_matrix = ratings_matrix.fillna(0)
ratings_matrix.head()
```


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>title</th>
      <th>'71 (2014)</th>
      <th>'Hellboy': The Seeds of Creation (2004)</th>
      <th>'Round Midnight (1986)</th>
      <th>'Salem's Lot (2004)</th>
      <th>'Til There Was You (1997)</th>
      <th>'Tis the Season for Love (2015)</th>
      <th>'burbs, The (1989)</th>
      <th>'night Mother (1986)</th>
      <th>(500) Days of Summer (2009)</th>
      <th>*batteries not included (1987)</th>
      <th>...</th>
      <th>Zulu (2013)</th>
      <th>[REC] (2007)</th>
      <th>[REC]² (2009)</th>
      <th>[REC]³ 3 Génesis (2012)</th>
      <th>anohana: The Flower We Saw That Day - The Movie (2013)</th>
      <th>eXistenZ (1999)</th>
      <th>xXx (2002)</th>
      <th>xXx: State of the Union (2005)</th>
      <th>¡Three Amigos! (1986)</th>
      <th>À nous la liberté (Freedom for Us) (1931)</th>
    </tr>
    <tr>
      <th>userId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 9719 columns</p>
</div>



- NaN 데이터는 fillna를 사용해 0으로 채워줌

<br>

### 3.7 행렬 transpose


```python
ratings_matrix_T = ratings_matrix.transpose()
ratings_matrix_T.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>userId</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>...</th>
      <th>601</th>
      <th>602</th>
      <th>603</th>
      <th>604</th>
      <th>605</th>
      <th>606</th>
      <th>607</th>
      <th>608</th>
      <th>609</th>
      <th>610</th>
    </tr>
    <tr>
      <th>title</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>'71 (2014)</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>'Hellboy': The Seeds of Creation (2004)</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Round Midnight (1986)</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Salem's Lot (2004)</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Til There Was You (1997)</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 610 columns</p>
</div>



- 행렬의 유사도 측정을 하기 위해 행렬을 transpose함

<br>

### 3.8 유사도 측정결과


```python
from sklearn.metrics.pairwise import cosine_similarity

item_sim = cosine_similarity(ratings_matrix_T, ratings_matrix_T)
item_sim_df = pd.DataFrame(data = item_sim, index=ratings_matrix.columns, columns=ratings_matrix.columns)

print(item_sim_df.shape)
item_sim_df.head()
```

    (9719, 9719)


<div style="width:100%; height:200px; overflow:auto">
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>title</th>
      <th>'71 (2014)</th>
      <th>'Hellboy': The Seeds of Creation (2004)</th>
      <th>'Round Midnight (1986)</th>
      <th>'Salem's Lot (2004)</th>
      <th>'Til There Was You (1997)</th>
      <th>'Tis the Season for Love (2015)</th>
      <th>'burbs, The (1989)</th>
      <th>'night Mother (1986)</th>
      <th>(500) Days of Summer (2009)</th>
      <th>*batteries not included (1987)</th>
      <th>...</th>
      <th>Zulu (2013)</th>
      <th>[REC] (2007)</th>
      <th>[REC]² (2009)</th>
      <th>[REC]³ 3 Génesis (2012)</th>
      <th>anohana: The Flower We Saw That Day - The Movie (2013)</th>
      <th>eXistenZ (1999)</th>
      <th>xXx (2002)</th>
      <th>xXx: State of the Union (2005)</th>
      <th>¡Three Amigos! (1986)</th>
      <th>À nous la liberté (Freedom for Us) (1931)</th>
    </tr>
    <tr>
      <th>title</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>'71 (2014)</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.141653</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.342055</td>
      <td>0.543305</td>
      <td>0.707107</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.139431</td>
      <td>0.327327</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Hellboy': The Seeds of Creation (2004)</th>
      <td>0.0</td>
      <td>1.000000</td>
      <td>0.707107</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Round Midnight (1986)</th>
      <td>0.0</td>
      <td>0.707107</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.176777</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Salem's Lot (2004)</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.857493</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>'Til There Was You (1997)</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.857493</td>
      <td>1.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 9719 columns</p>
</div>



- 전체 영화에 대해 유사도 점수가 나옴

<br>

### 3.9 대부와 유사한 영화는?


```python
item_sim_df['Godfather, The (1972)'].sort_values(ascending = False)[:10]
```




    title
    Godfather, The (1972)                                    1.000000
    Godfather: Part II, The (1974)                           0.821773
    Goodfellas (1990)                                        0.664841
    One Flew Over the Cuckoo's Nest (1975)                   0.620536
    Star Wars: Episode IV - A New Hope (1977)                0.595317
    Fargo (1996)                                             0.588614
    Star Wars: Episode V - The Empire Strikes Back (1980)    0.586030
    Fight Club (1999)                                        0.581279
    Reservoir Dogs (1992)                                    0.579059
    Pulp Fiction (1994)                                      0.575270
    Name: Godfather, The (1972), dtype: float64



- 대부2편, 등 스타워즈..음.. 잘 모르겠다

<br>

### 3.10 인셉션과 비슷한 영화는?


```python
item_sim_df['Inception (2010)'].sort_values(ascending = False)[:10]
```




    title
    Inception (2010)                 1.000000
    Dark Knight, The (2008)          0.727263
    Inglourious Basterds (2009)      0.646103
    Shutter Island (2010)            0.617736
    Dark Knight Rises, The (2012)    0.617504
    Fight Club (1999)                0.615417
    Interstellar (2014)              0.608150
    Up (2009)                        0.606173
    Avengers, The (2012)             0.586504
    Django Unchained (2012)          0.581342
    Name: Inception (2010), dtype: float64



- 다크나이트, 인터스텔라 등 뭔가 비슷해 보이기도 하는 영화가 나왔음

<br>

## 4. 요약
---
### 4.1 요약

- 추천 시스템은 많은 분야에서 사용된다.
- 컨텐츠 기반, 아이템 기반 추천 시스템을 간단히 실습해보았다.
- 추천 시스템은 제대로 되었는지, 추천 받는 사람이 직접적인 평가를 해주지 않기 떄문에 사실 제대로 하고 있는지 알수 없다.
- 그래도, 넷플릭스, 유튜브 등 에서 추천알고리즘이 많이 사용되고 있고, 자연어처럼 발전이 무궁무진하다고 생각한다.
- 더 자세한 공부가 필요하다.
