---
title: LangChain ì‚¬ìš© ì‚¬ë¡€ íŠœí† ë¦¬ì–¼ íŒŒíŠ¸2
author: HyunMin Kim
date: 2023-09-12 00:00:00 0000
categories: [Data Science, Prompt Engineering]
tags: [LangChain]
image: https://github.com/hmkim312/hmkim312.github.io/assets/60168331/0ad3d9b9-e090-4df0-ab4a-bb1b62e30175
---

*í•´ë‹¹ ì¿¡ë¶ì€ [LangChain Cookbook Part 2 - Use Cases](https://github.com/gkamradt/langchain-tutorials/blob/main/LangChain%20Cookbook%20Part%202%20-%20Use%20Cases.ipynb){:target="_blank"}ë¥¼ í•œê¸€ë¡œ ë²ˆì—­í•œ ê²ƒì´ë©° 
[LangChain Conceptual Documentation](https://docs.langchain.com/docs/){:target="_blank"}ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„± ë˜ì—ˆìŠµë‹ˆë‹¤.*

**ëª©í‘œ:**
ELI5ì˜ˆì œì™€ ì½”ë“œë¥¼ í†µí•´ LangChainì˜ êµ¬ì„± ìš”ì†Œì™€ ì‚¬ìš© ì‚¬ë¡€ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ì´í•´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. LangChainì˜ *ê¸°ë³¸ ì›ì¹™*ì— ëŒ€í•œ ì†Œê°œëŠ” [ì¿¡ë¶ íŒŒíŠ¸ 1: ê¸°ë³¸](https://github.com/gkamradt/langchain-tutorials/blob/main/LangChain%20Cookbook%20Part%201%20-%20Fundamentals.ipynb){:target="_blank"}ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

**ë§í¬:**
* [LC ê°œë… ë¬¸ì„œ](https://docs.langchain.com/docs/){:target="_blank"}
* [LC íŒŒì´ì¬ ë¬¸ì„œ](https://python.langchain.com/en/latest/){:target="_blank"}
* [LC ìë°”ìŠ¤í¬ë¦½íŠ¸/íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ë¬¸ì„œ](https://js.langchain.com/docs/){:target="_blank"}
* [LC ë””ìŠ¤ì½”ë“œ](https://discord.gg/6adMQxSpJS){:target="_blank"}
* [www.langchain.com](https://langchain.com/){:target="_blank"}
* [LC íŠ¸ìœ„í„°](https://twitter.com/LangChainAI){:target="_blank"}


## 1. **LangChain ì´ë€?**
> LangChainì€ ì–¸ì–´ ëª¨ë¸(LLM) ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê¸° ìœ„í•œ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

**ìš”ì•½**: LangChainì€ AI ëª¨ë¸ê³¼ ì‘ì—… ë° êµ¬ì¶•í•˜ëŠ” ë³µì¡í•œ ë¶€ë¶„ì„ ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤:
1. **í†µí•©** - íŒŒì¼, ì• í”Œë¦¬ì¼€ì´ì…˜, API ë°ì´í„°ì™€ ê°™ì€ ì™¸ë¶€ ë°ì´í„°ë¥¼ LLMì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
2. **ì—ì´ì „ì‹œ** - LLMì„ í†µí•´ ë‹¤ìŒì— ì–´ë–¤ ì¡°ì¹˜ë¥¼ ì·¨í• ì§€ ê²°ì •í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

## 2. **ì™œ LangChainì¸ê°€?**
1. **êµ¬ì„± ìš”ì†Œ** - LangChainì€ ì–¸ì–´ ëª¨ë¸ê³¼ í•¨ê»˜ ì‘ì—…í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ì¶”ìƒí™”ì™€ êµ¬ì„± ìš”ì†Œë¥¼ ì‰½ê²Œ êµì²´í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
2. **ì‚¬ìš©ì ì •ì˜ ì²´ì¸** - LangChainì€ 'ì²´ì¸' - ì—°ì†ëœ ì¼ë ¨ì˜ ë™ì‘ - ì„ ì‚¬ìš©í•˜ê³  ì‚¬ìš©ì ì •ì˜í•˜ëŠ” ë° í•„ìš”í•œ ì§€ì›ì„ ì œê³µí•©ë‹ˆë‹¤.
3. **ì†ë„ ğŸš¢** - ë¹ ë¥¸ ì—…ë°ì´íŠ¸ë¡œ ìµœì‹  LLM ê¸°ëŠ¥ì„ ê³„ì†í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ì»¤ë®¤ë‹ˆí‹° ğŸ‘¥** - ë””ìŠ¤ì½”ë“œì™€ ì»¤ë®¤ë‹ˆí‹° ì§€ì›, ëª¨ì„, í•´ì»¤í†¤ ë“±ì´ í™œë°œí•©ë‹ˆë‹¤.

LLMì€ ê°„ë‹¨í•  ìˆ˜ ìˆì§€ë§Œ(í…ìŠ¤íŠ¸ ì…ë ¥, í…ìŠ¤íŠ¸ ì¶œë ¥) ë” ë³µì¡í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ë©´ LangChainì´ ë„ì™€ì£¼ëŠ” ë¬¸ì œì ì— ë¶€ë”ªí ê²ƒì…ë‹ˆë‹¤.
*ì°¸ê³ : ì´ ì¿¡ë¶ì€ LangChainì˜ ëª¨ë“  ì¸¡ë©´ì„ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‚´ìš©ì€ ê°€ëŠ¥í•œ ë¹ ë¥´ê²Œ ì„¤ê³„ í•˜ëŠ”ê²ƒìœ¼ë¡œ ì„ ë³„ë˜ì—ˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [LangChain ê°œë… ë¬¸ì„œ](https://docs.langchain.com/docs/){:target="_blank"}ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.*,

## 3. **ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€**

* **ìš”ì•½ (Summarization)** - í…ìŠ¤íŠ¸ ë˜ëŠ” ì±„íŒ… ìƒí˜¸ì‘ìš©ì— ëŒ€í•œ ê°€ì¥ ì¤‘ìš”í•œ ì‚¬ì‹¤ì„ í‘œí˜„.
* **ë¬¸ì„œë¥¼ í†µí•œ ì§ˆë¬¸ ë° ë‹µë³€ (Question and Answering Over Documents)** - ë¬¸ì„œ ë‚´ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ˆë¬¸ì— ë‹µí•˜ê±°ë‚˜ ì¡°íšŒ.
* **ì¶”ì¶œ (Extraction)** - í…ìŠ¤íŠ¸ ë˜ëŠ” ì‚¬ìš©ì ì¿¼ë¦¬ì—ì„œ êµ¬ì¡°í™”ëœ ë°ì´í„° ì¶”ì¶œ.
* **í‰ê°€ (Evaluation)** - ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶œë ¥ í’ˆì§ˆ ì´í•´.
* **í‘œ í˜•ì‹ì˜ ë°ì´í„° ì¿¼ë¦¬ (Querying Tabular DataQ)** - ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ë‹¤ë¥¸ í‘œ í˜•ì‹ì˜ ì†ŒìŠ¤ì—ì„œ ë°ì´í„° ì¶”ì¶œ.
* **ì½”ë“œ ì´í•´ (Code Understanding)** - ì½”ë“œì— ëŒ€í•œ ì´ìœ ë¥¼ ì œì‹œí•˜ê³  ìš”ì•½.
* **APIì™€ì˜ ìƒí˜¸ì‘ìš© (Interacting with APIs)** - API ì¿¼ë¦¬ ë° ì™¸ë¶€ì™€ ìƒí˜¸ì‘ìš©.
* **ì±—ë´‡ (Chatbots)** - ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ì—ì„œ ë©”ëª¨ë¦¬ì™€ ê²°í•©í•˜ì—¬ ì‚¬ìš©ìì™€ ì•ë’¤ë¡œ ìƒí˜¸ ì‘ìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬.
* **ì—ì´ì „íŠ¸ (Agents)** - ë‹¤ìŒì— ë¬´ì—‡ì„ í•´ì•¼ í• ì§€ ê²°ì •í•˜ê¸° ìœ„í•´ LLMs ì‚¬ìš©. ì´ëŸ¬í•œ ê²°ì •ì„ ë„êµ¬ë¡œ ì§€ì›.

ì´ëŸ¬í•œ ì‚¬ìš© ì‚¬ë¡€ì˜ ì‹¤ì œ ì˜ˆì œë¥¼ ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? [LangChain í”„ë¡œì íŠ¸ ê°¤ëŸ¬ë¦¬](https://github.com/gkamradt/langchain-tutorials){:target="_blank"}ë¡œ ì´ë™í•˜ì„¸ìš”.

**ì €ìì˜ ë…¸íŠ¸:**

* ì´ ì¿¡ë¶ì€ LangChainì˜ ëª¨ë“  ì¸¡ë©´ì„ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ë‚´ìš©ì€ ê°€ëŠ¥í•œ ë¹ ë¥´ê²Œ ê±´ì„¤í•˜ê³  ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆë„ë¡ ì„ ë³„ë˜ì—ˆìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ë‚´ìš©ì€ [LangChain ê¸°ìˆ  ë¬¸ì„œ](https://python.langchain.com/en/latest/index.html){:target="_blank"}ë¥¼ ì°¸ì¡°í•´ ì£¼ì„¸ìš”.
* ì´ ë…¸íŠ¸ë¶ì€ ì—¬ëŸ¬ë¶„ì´ ì´ ì‹œë¦¬ì¦ˆì˜ 1ë¶€ [ê¸°ë³¸ ì›ì¹™](https://github.com/gkamradt/langchain-tutorials/blob/main/LangChain%20Cookbook%20Part%201%20-%20Fundamentals.ipynb){:target="_blank"}ì„ ë³´ì•˜ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤. ì´ ë…¸íŠ¸ë¶ì€ ë¬´ì—‡ì„ í•´ì•¼ í•˜ëŠ”ì§€ì™€ ê·¸ ê¸°ë³¸ ì›ì¹™ì„ ì–´ë–»ê²Œ ì ìš©í•˜ëŠ”ì§€ì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.
* ë…¸íŠ¸ë¶ ì „ì²´ì—ì„œ import ë¬¸ì„ ë°˜ë³µí•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì œ ëª©í‘œëŠ” ëª…í™•ì„±ì„ ìœ ì§€í•˜ê³  ì „ì²´ ì½”ë“œ ë¸”ë¡ì„ í•œ ê³³ì—ì„œ ë³¼ ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. íŒ¨í‚¤ì§€ë¥¼ ì–¸ì œ ê°€ì ¸ì™”ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì™”ë‹¤ê°”ë‹¤ í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
* ë…¸íŠ¸ë¶ ì „ì²´ì—ì„œ ê¸°ë³¸ ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì‘ì„± ì‹œì ì—ì„œ ê·¸ê²ƒë“¤ì€ davinci-003ê³¼ gpt-3.5-turboì˜€ìŠµë‹ˆë‹¤. GPT4ë¥¼ ì‚¬ìš©í•˜ë©´ ë” ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

*ì´ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” OpenAIì˜ ë‹¤ì–‘í•œ [ëª¨ë¸](https://platform.openai.com/docs/models/overview){:target="_blank"}ì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤. LangChainì€ [LLMsë¥¼ ëŒ€ì²´](https://langchain.com/integrations.html#:~:text=integrations%20LangChain%20provides.-,LLMs,-LLM%20Provider){:target="_blank"}í•˜ëŠ” ê²ƒì„ ì‰½ê²Œ í•´ì¤ë‹ˆë‹¤. ë”°ë¼ì„œ ì›í•œë‹¤ë©´ ìì‹ ë§Œì˜ LLMì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.*


```python
import os

openai_api_key='YOUR OPENAI API KEY'
```


```python
# data í´ë” ìƒì„±
folder_path = "./data"

# í´ë”ê°€ ì´ë¯¸ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ë§Œ ìƒì„±
if not os.path.exists(folder_path):
    os.makedirs(folder_path)
else:
    print("Folder already exists. Pass.")
```

    Folder already exists. Pass.



```python
# ë””ìŠ¤í”Œë ˆì´ë¥¼ ë” ë„“ê²Œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ ì´ ì…€ì„ ì‹¤í–‰í•˜ì„¸ìš”
from IPython.display import display, HTML
display(HTML("<style>.container { width:90% !important; }</style>"))
```


<style>.container { width:90% !important; }</style>


## 4. ìš”ì•½ (Summarization)

LangChainê³¼ LLMsì˜ ê°€ì¥ ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€ ì¤‘ í•˜ë‚˜ëŠ” ìš”ì•½ì…ë‹ˆë‹¤. ëª¨ë“  í…ìŠ¤íŠ¸ë¥¼ ìš”ì•½í•  ìˆ˜ ìˆì§€ë§Œ, ì „í™” í†µí™”, ê¸°ì‚¬, ì±…, í•™ìˆ  ë…¼ë¬¸, ë²•ë¥  ë¬¸ì„œ, ì‚¬ìš©ì íˆìŠ¤í† ë¦¬, í‘œ, ì¬ë¬´ ë¬¸ì„œ ë“±ì„ ìš”ì•½í•˜ëŠ” ê²ƒì— ì‚¬ìš©ë©ë‹ˆë‹¤. ì •ë³´ë¥¼ ë¹ ë¥´ê²Œ ìš”ì•½í•  ìˆ˜ ìˆëŠ” ë„êµ¬ê°€ ìˆìœ¼ë©´ ì •ë§ ë„ì›€ì´ ë©ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - (ê³§ ì œê³µë©ë‹ˆë‹¤)
* **ì˜ˆì œ** - [B2B íŒë§¤ í†µí™” ìš”ì•½í•˜ê¸°](https://www.youtube.com/watch?v=DIw4rbpI9ic){:target="_blank"}
* **ì‚¬ìš© ì‚¬ë¡€** - ê¸°ì‚¬, ëŒ€ë³¸, ì±„íŒ… ê¸°ë¡, ìŠ¬ë™/ë””ìŠ¤ì½”ë“œ, ê³ ê° ìƒí˜¸ì‘ìš©, ì˜í•™ ë…¼ë¬¸, ë²•ë¥  ë¬¸ì„œ, íŒŸìºìŠ¤íŠ¸, íŠ¸ìœ— ìŠ¤ë ˆë“œ, ì½”ë“œ ë² ì´ìŠ¤, ì œí’ˆ ë¦¬ë·°, ì¬ë¬´ ë¬¸ì„œ ìš”ì•½

### 1) ì§§ì€ í…ìŠ¤íŠ¸ì˜ ìš”ì•½

ì§§ì€ í…ìŠ¤íŠ¸ì˜ ìš”ì•½ì˜ ê²½ìš° ë°©ë²•ì€ ê°„ë‹¨í•˜ë©°, ì‹¤ì œë¡œëŠ” ê°„ë‹¨í•œ ì§€ì‹œì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡¬í”„íŠ¸í•˜ëŠ” ê²ƒ ì™¸ì—ëŠ” íŠ¹ë³„íˆ í•  ê²ƒì´ ì—†ìŠµë‹ˆë‹¤.


```python
from langchain.llms import OpenAI
from langchain import PromptTemplate

# ê¸°ë³¸ ëª¨ë¸ì€ ì´ë¯¸ 'text-davinci-003'ì´ì§€ë§Œ ë‚˜ì¤‘ì— ì›í•  ê²½ìš° ë³€ê²½í•  ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆë„ë¡ ì—¬ê¸°ì„œ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.
llm = OpenAI(temperature=0, model_name='text-davinci-003', openai_api_key=openai_api_key)

# í…œí”Œë¦¿ ìƒì„±
template = """
%INSTRUCTIONS:
Please summarize the following piece of text.
Respond in a manner that a 5 year old would understand.

%TEXT:
{text}
"""

# ë‚˜ì¤‘ì— ê°’ì„ ì‚½ì…í•  ìˆ˜ ìˆëŠ” LangChain í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ë§Œë“­ë‹ˆë‹¤.
prompt = PromptTemplate(
    input_variables=["text"],
    template=template,
)
```

ì˜¨ë¼ì¸ì—ì„œ í˜¼ë€ìŠ¤ëŸ¬ìš´ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì•„ë´…ì‹œë‹¤. *[ì¶œì²˜](https://www.smithsonianmag.com/smart-news/long-before-trees-overtook-the-land-earth-was-covered-by-giant-mushrooms-13709647/){:target="_blank"}*


```python
confusing_text = """
ê·¸ í›„ 130ë…„ ë™ì•ˆ ë…¼ìŸì´ ê²©ë ¬í•´ì¡ŒìŠµë‹ˆë‹¤.
ì¼ë¶€ ê³¼í•™ìë“¤ì€ í”„ë¡œí† íƒì‚¬ì´íŠ¸ë¥¼ ì§€ì˜ë¥˜ë¼ê³  ë¶ˆë €ê³ , ë‹¤ë¥¸ ê³¼í•™ìë“¤ì€ ê³°íŒ¡ì´ë¼ê³  ë¶ˆë €ìœ¼ë©°, ë˜ ë‹¤ë¥¸ ê³¼í•™ìë“¤ì€ ê·¸ê²ƒì´ ì¼ì¢…ì˜ ë‚˜ë¬´ë¼ëŠ” ê°œë…ì— ì§‘ì°©í–ˆìŠµë‹ˆë‹¤.
ì§€êµ¬ë¬¼ë¦¬í•™ ë¶€êµìˆ˜ì´ì ì§„í™”ìƒë¬¼í•™ìœ„ì›íšŒì˜ ë³´ì´ìŠ¤(Boyce)ëŠ” â€œë¬¸ì œëŠ” í•´ë¶€í•™ì  êµ¬ì¡°ë¥¼ ê°€ê¹Œì´ì„œ ë³´ë©´ ë‹¤ì–‘í•œ ê²ƒë“¤ì´ ì—°ìƒë˜ì§€ë§Œ ì§„ë‹¨ ê²°ê³¼ëŠ” ì•„ë¬´ê²ƒë„ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.â€ë¼ê³  ë§í•©ë‹ˆë‹¤.
"ê·¸ë¦¬ê³  ê·¸ê²ƒì€ ë„ˆë¬´ ì»¤ì„œ ëˆ„êµ°ê°€ê°€ ê·¸ê²ƒì´ ë¬´ì—‡ì´ë¼ê³  ë§í•  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì¼ì–´ë‚˜ì„œ 'ì–´ë–»ê²Œ 20í”¼íŠ¸ ë†’ì´ì˜ ì´ë¼ë¥˜ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹ˆ?'ë¼ê³  ë§í•©ë‹ˆë‹¤."
"""
```

LLMì— ì–´ë–¤ í”„ë¡¬í”„íŠ¸ê°€ ì „ì†¡ë˜ëŠ”ì§€ ì‚´í´ ë³´ê² ìŠµë‹ˆë‹¤.


```python
print ("------- Prompt Begin -------")

final_prompt = prompt.format(text=confusing_text)
print(final_prompt)

print ("------- Prompt End -------")
```

    ------- Prompt Begin -------
    
    %INSTRUCTIONS:
    Please summarize the following piece of text.
    Respond in a manner that a 5 year old would understand.
    
    %TEXT:
    
    ê·¸ í›„ 130ë…„ ë™ì•ˆ ë…¼ìŸì´ ê²©ë ¬í•´ì¡ŒìŠµë‹ˆë‹¤.
    ì¼ë¶€ ê³¼í•™ìë“¤ì€ í”„ë¡œí† íƒì‚¬ì´íŠ¸ë¥¼ ì§€ì˜ë¥˜ë¼ê³  ë¶ˆë €ê³ , ë‹¤ë¥¸ ê³¼í•™ìë“¤ì€ ê³°íŒ¡ì´ë¼ê³  ë¶ˆë €ìœ¼ë©°, ë˜ ë‹¤ë¥¸ ê³¼í•™ìë“¤ì€ ê·¸ê²ƒì´ ì¼ì¢…ì˜ ë‚˜ë¬´ë¼ëŠ” ê°œë…ì— ì§‘ì°©í–ˆìŠµë‹ˆë‹¤.
    ì§€êµ¬ë¬¼ë¦¬í•™ ë¶€êµìˆ˜ì´ì ì§„í™”ìƒë¬¼í•™ìœ„ì›íšŒì˜ ë³´ì´ìŠ¤(Boyce)ëŠ” â€œë¬¸ì œëŠ” í•´ë¶€í•™ì  êµ¬ì¡°ë¥¼ ê°€ê¹Œì´ì„œ ë³´ë©´ ë‹¤ì–‘í•œ ê²ƒë“¤ì´ ì—°ìƒë˜ì§€ë§Œ ì§„ë‹¨ ê²°ê³¼ëŠ” ì•„ë¬´ê²ƒë„ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.â€ë¼ê³  ë§í•©ë‹ˆë‹¤.
    "ê·¸ë¦¬ê³  ê·¸ê²ƒì€ ë„ˆë¬´ ì»¤ì„œ ëˆ„êµ°ê°€ê°€ ê·¸ê²ƒì´ ë¬´ì—‡ì´ë¼ê³  ë§í•  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì¼ì–´ë‚˜ì„œ 'ì–´ë–»ê²Œ 20í”¼íŠ¸ ë†’ì´ì˜ ì´ë¼ë¥˜ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹ˆ?'ë¼ê³  ë§í•©ë‹ˆë‹¤."
    
    
    ------- Prompt End -------


ë§ˆì§€ë§‰ìœ¼ë¡œ LLMì„ í†µê³¼í•´ ë³´ê² ìŠµë‹ˆë‹¤.


```python
output = llm(final_prompt)
print (output)
```

    
    ì‚¬ëŒë“¤ì´ 130ë…„ ë™ì•ˆ ë…¼ìŸí•˜ë˜ ê±´ ê·¸ë¦¼ìê°€ ì§€ì˜ë¥˜ë¼ê³  ë¶ˆë¦¬ëŠ” ê±°ëŒ€í•œ ë‚˜ë¬´ë¼ê³  ìƒê°í•˜ëŠ” ì‚¬ëŒë“¤ê³¼ ê³°íŒ¡ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì‘ì€ ë‚˜ë¬´ë¼ê³  ìƒê°í•˜ëŠ” ì‚¬ëŒë“¤ ì‚¬ì´ì—ìš”. ê·¸ë¦¬ê³  ê·¸ê²ƒì´ ë¬´ì—‡ì¸ì§€ ì•Œ ìˆ˜ ì—†ì–´ì„œ ëˆ„êµ°ê°€ê°€ 20í”¼íŠ¸ ë†’ì´ì˜


ì´ ë°©ë²•ì€ ì˜ ì‘ë™í•˜ì§€ë§Œ, ê¸´ í…ìŠ¤íŠ¸ì˜ ê²½ìš° ê´€ë¦¬ê°€ ë²ˆê±°ë¡œì›Œì§ˆ ìˆ˜ ìˆê³  í† í° í•œë„ì— ë¶€ë”ªí ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤í–‰íˆ LangChainì€ [load_summarize_chain](https://python.langchain.com/en/latest/use_cases/summarization.html){:target="_blank"}ì„ í†µí•´ ìš”ì•½í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì— ëŒ€í•œ ê¸°ë³¸ ì§€ì›ì„ ì œê³µí•©ë‹ˆë‹¤.

### 2) ê¸´ í…ìŠ¤íŠ¸ì˜ ìš”ì•½

*ì°¸ê³ : ì´ ë°©ë²•ì€ ì§§ì€ í…ìŠ¤íŠ¸ì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.*


```python
from langchain.llms import OpenAI
from langchain.chains.summarize import load_summarize_chain
from langchain.text_splitter import RecursiveCharacterTextSplitter

llm = OpenAI(temperature=0, openai_api_key=openai_api_key)
```

ì¥ë¬¸ì˜ ì˜ì–´ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ


```python
# ìƒ˜í”Œ ë°ì´í„° ë‹¤ìš´
import requests

url = "https://raw.githubusercontent.com/hmkim312/datas/main/Langchain/good.txt"
response = requests.get(url)

# íŒŒì¼ì„ ì €ì¥í•˜ê¸°
file_name = "./data/PaulGrahamEssays/good.txt"
with open(file_name, 'w', encoding="utf-8") as f:
    f.write(response.text)
```


```python
with open(file_name, 'r') as file:
    text = file.read()

# ì²˜ìŒ 285ìë¥¼ ë¯¸ë¦¬ë³´ê¸°
print (text[:285])
```

    April 2008(This essay is derived from a talk at the 2008 Startup School.)About a month after we started Y Combinator we came up with the
    phrase that became our motto: Make something people want.  We've
    learned a lot since then, but if I were choosing now that's still
    the one I'd pick.


ì´ ë¬¸ì„œì— ì–¼ë§ˆë‚˜ ë§ì€ í† í°ì´ ìˆëŠ”ì§€ í™•ì¸í•´ ë´…ì‹œë‹¤. [get_num_tokens](https://python.langchain.com/en/latest/reference/modules/llms.html#langchain.llms.OpenAI.get_num_tokens){:target="_blank"}ëŠ” ì´ë¥¼ ìœ„í•œ ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤.


```python
num_tokens = llm.get_num_tokens(text)

print (f"í•´ë‹¹ íŒŒì¼ì—ëŠ” {num_tokens}ê°œì˜ í† í°ì´ ìˆìŠµë‹ˆë‹¤.")
```

    í•´ë‹¹ íŒŒì¼ì—ëŠ” 3970ê°œì˜ í† í°ì´ ìˆìŠµë‹ˆë‹¤.


ë‹¹ì‹ ì€ ì´ í…ìŠ¤íŠ¸ë¥¼ í”„ë¡¬í”„íŠ¸ì— ë„£ì„ ìˆ˜ ìˆì„ ê²ƒ ê°™ì§€ë§Œ, ë„ˆë¬´ í¬ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤. ë¨¼ì € ì´ê²ƒì„ ë‚˜ëˆ„ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì„ 'chunking' ë˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì‘ì€ ì¡°ê°ìœ¼ë¡œ 'split'ë¼ê³  í•©ë‹ˆë‹¤. ì €ëŠ” [RecursiveCharacterTextSplitter](https://python.langchain.com/en/latest/modules/indexes/text_splitters/examples/recursive_text_splitter.html){:target="_blank"}ë¥¼ ì¢‹ì•„í•˜ëŠ”ë°, ê·¸ê²ƒì€ ì œì–´í•˜ê¸° ì‰½ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆëŠ” [ì—¬ëŸ¬ ê°€ì§€](https://python.langchain.com/en/latest/modules/indexes/text_splitters.html){:target="_blank"}ê°€ ìˆìŠµë‹ˆë‹¤.


```python
text_splitter = RecursiveCharacterTextSplitter(separators=["\n\n", "\n"], chunk_size=5000, chunk_overlap=350)
docs = text_splitter.create_documents([text])

print (f"ì´ì œ 1ê°œì˜ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ {len(docs)}ê°œì˜ ë¬¸ì„œê°€ ìˆìŠµë‹ˆë‹¤.")
```

    ì´ì œ 1ê°œì˜ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ 4ê°œì˜ ë¬¸ì„œê°€ ìˆìŠµë‹ˆë‹¤.


ë‹¹ì‹ ì€ ì—°ì†ì ìœ¼ë¡œ LLMì— í˜¸ì¶œì„ í•  ìˆ˜ ìˆëŠ” ì²´ì¸ì„ ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤. ì•„ë˜ ì²´ì¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´ [LangChain ë¬¸ì„œ](https://github.com/hwchase17/langchain/blob/master/langchain/chains/summarize/map_reduce_prompt.py){:target="_blank"}ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.

ì²´ì¸ ìœ í˜• ê°„ì˜ ì°¨ì´ì ì— ëŒ€í•œ ì •ë³´ëŠ” [í† í° ì œí•œ í•´ê²° ë°©ë²•](https://youtu.be/f9_BWhCI4Zo){:target="_blank"} ì´ë¼ëŠ” ë¹„ë””ì˜¤ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

*ì°¸ê³ : ì²˜ìŒ 4íšŒì˜ map_reduce í˜¸ì¶œì„ ë™ì‹œì— ë³‘ë ¬ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.*


```python
# chain ì‚¬ìš© ì¤€ë¹„
chain = load_summarize_chain(llm=llm, chain_type='map_reduce') # verbose=True LLMìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ë‚´ìš©ì„ í™•ì¸í•˜ëŠ” ì„ íƒ ì‚¬í•­
```


```python
# ì´ê²ƒì€ 4ê°œì˜ ë¬¸ì„œë¥¼ í†µê³¼í•˜ì—¬ chunkë“¤ì„ ìš”ì•½í•˜ê³ , ê·¸ ìš”ì•½ì˜ ìš”ì•½ì„ ì–»ê²Œ ë©ë‹ˆë‹¤.
output = chain.run(docs)
print (output)
```

     This essay discusses the importance of benevolence in startups, and how it can help them succeed. It explains how benevolence can improve morale, make people want to help, and help startups be decisive. It also explains how being benevolent and committed can make startups hard to kill, and how it can attract investors, customers, other companies, and potential employees. Finally, it looks at how markets have evolved to value potential dividends and potential earnings, and how users dislike their new operating system.


## 5. ë¬¸ì„œë¥¼ í†µí•œ ì§ˆë¬¸ ë° ë‹µë³€ (Question & Answering Using Documents As Context)

*[LangChain ì§ˆë¬¸ & ë‹µë³€ ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/question_answering.html){:target="_blank"}*

LLMì„ ì‚¬ìš©í•˜ì—¬ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ìœ„í•´ ìš°ë¦¬ëŠ”:

1. ì§ˆë¬¸ì— ë‹µí•˜ëŠ” ë° í•„ìš”í•œ ê´€ë ¨ ë§¥ë½ì„ LLMì— ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
2. ìš°ë¦¬ê°€ ë‹µë³€ì„ ì›í•˜ëŠ” ì§ˆë¬¸ì„ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.

ê°„ë‹¨íˆ ë§í•˜ë©´, ì´ ê³¼ì •ì€ "llm(ë‹¹ì‹ ì˜ ë§¥ë½ + ë‹¹ì‹ ì˜ ì§ˆë¬¸) = ë‹¹ì‹ ì˜ ë‹µë³€"ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - [ì±…ì— ì§ˆë¬¸í•˜ê¸°](https://youtu.be/h0DHDp1FbmQ){:target="_blank"}, [ë‹¹ì‹ ì˜ ì‚¬ìš©ì ì •ì˜ íŒŒì¼ì— ì§ˆë¬¸í•˜ê¸°](https://youtu.be/EnT-ZTrcPrg){:target="_blank"}, [Chat Your Data JS (1000 í˜ì´ì§€ì˜ ê¸ˆìœµ ë³´ê³ ì„œ)](https://www.youtube.com/watch?v=Ix9WIZpArm0&t=1051s){:target="_blank"}, [LangChain Q&A ì›¹ì„¸ë¯¸ë‚˜](https://www.crowdcast.io/c/rh66hcwivly0){:target="_blank"}
* **ì˜ˆì‹œ** - [ChatPDF](https://www.chatpdf.com/){:target="_blank"}
* **ì‚¬ìš© ì‚¬ë¡€** - ë¬¸ì„œì™€ ëŒ€í™”í•˜ê¸°, í•™ìˆ  ë…¼ë¬¸ì— ì§ˆë¬¸í•˜ê¸°, í•™ìŠµ ê°€ì´ë“œ ë§Œë“¤ê¸°, ì˜í•™ ì •ë³´ ì°¸ì¡°í•˜ê¸°.

### 1) ê°„ë‹¨í•œ Q&A ì˜ˆì‹œ

ì—¬ê¸°ì„œ `llm(ë‹¹ì‹ ì˜ ë§¥ë½ + ë‹¹ì‹ ì˜ ì§ˆë¬¸) = ë‹¹ì‹ ì˜ ë‹µë³€`ì˜ ê·œì¹™ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.


```python
from langchain.llms import OpenAI

llm = OpenAI(temperature=0, openai_api_key=openai_api_key, model_name="gpt-3.5-turbo-16k")
```

    /home/hyunmin-kim/anaconda3/lib/python3.10/site-packages/langchain/llms/openai.py:200: UserWarning: You are trying to use a chat model. This way of initializing it is no longer supported. Instead, please use: `from langchain.chat_models import ChatOpenAI`
      warnings.warn(
    /home/hyunmin-kim/anaconda3/lib/python3.10/site-packages/langchain/llms/openai.py:787: UserWarning: You are trying to use a chat model. This way of initializing it is no longer supported. Instead, please use: `from langchain.chat_models import ChatOpenAI`
      warnings.warn(



```python
context = """
ë ˆì´ì²¼ì€ 30ì‚´ ì…ë‹ˆë‹¤.
ë°¥ì€ 45ì‚´ ì…ë‹ˆë‹¤.
ì¼€ë¹ˆì€ 65ì‚´ ì…ë‹ˆë‹¤.
"""

question = "40ì„¸ ì´í•˜ëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?"
```

ë§¥ë½ê³¼ ì§ˆë¬¸ì˜ ê²°í•©


```python
output = llm(context + question)

# ì•ë’¤ ê³µë°±ì„ ì œê±°í•˜ê¸° ìœ„í•´ í…ìŠ¤íŠ¸ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
print (output.strip())
```

    40ì„¸ ì´í•˜ëŠ” ë ˆì´ì²¼ì…ë‹ˆë‹¤.


ìš°ë¦¬ê°€ ë”ìš± ì •êµí•´ì§ˆìˆ˜ë¡ ì´ ê·œì¹™ì„ ë”ìš± í™œìš©í•˜ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

ì–´ë ¤ìš´ ë¶€ë¶„ì€ *ì–´ë–¤* ë°ì´í„°ë¥¼ ë§¥ë½ì— ë„£ì„ì§€ ì„ íƒì ìœ¼ë¡œ ê²°ì •í•´ì•¼ í•  ë•Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì´ ì—°êµ¬ ë¶„ì•¼ëŠ” "[ë¬¸ì„œ ê²€ìƒ‰](https://python.langchain.com/en/latest/modules/indexes/retrievers.html)"ì´ë¼ê³  ë¶ˆë¦¬ë©° AI ë©”ëª¨ë¦¬ì™€ ë°€ì ‘í•˜ê²Œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### 2) ì„ë² ë”© ì‚¬ìš©í•˜ê¸°

ìš°ë¦¬ê°€ ì§€ê¸ˆë¶€í„° ë‹¤ë£° ê³¼ì •ì„ ë‚˜ëŠ” ë¹„ê³µì‹ì ìœ¼ë¡œ "ë²¡í„°ìŠ¤í† ì–´ ëŒ„ìŠ¤(VectorStore Dance)"ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤. ì´ëŠ” í…ìŠ¤íŠ¸ë¥¼ ë¶„í• í•˜ê³ , ì„ë² ë”©ì„ ì ìš©í•œ ë‹¤ìŒ, ì´ ì„ë² ë”©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê³ , ê·¸ í›„ì— ì¿¼ë¦¬í•˜ëŠ” ê³¼ì •ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [How To Question A Book](https://www.youtube.com/watch?v=h0DHDp1FbmQ){:target="_blank"} ë¹„ë””ì˜¤ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

ìš°ë¦¬ì˜ ëª©í‘œëŠ” ê¸´ í…ìŠ¤íŠ¸ì—ì„œ ê´€ë ¨ëœ ì²­í¬ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ°ë° ì–´ë–¤ ì²­í¬ë¥¼ ì„ íƒí•´ì•¼ í• ê¹Œìš”? ê°€ì¥ ì¸ê¸° ìˆëŠ” ë°©ë²•ì€ ë²¡í„° ì„ë² ë”©ì„ ê¸°ë°˜ìœ¼ë¡œ ë¹„êµí•˜ì—¬ *ìœ ì‚¬í•œ* í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


```python
from langchain import OpenAI

# ë²¡í„° ìŠ¤í† ì–´
from langchain.vectorstores import FAISS

# ë¬¸ì„œë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‚¬ìš©í•  LangChain êµ¬ì„± ìš”ì†Œ
from langchain.chains import RetrievalQA

# í…ìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê°„í¸í•œ ë¬¸ì„œ ë¡œë”
from langchain.document_loaders import TextLoader

# í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜í•˜ëŠ” ì„ë² ë”© ì—”ì§„
from langchain.embeddings.openai import OpenAIEmbeddings

llm = OpenAI(temperature=0, openai_api_key=openai_api_key)
```

ì¥ë¬¸ì˜ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ


```python
import requests

url = "https://raw.githubusercontent.com/hmkim312/datas/main/Langchain/worked.txt"
response = requests.get(url)

# íŒŒì¼ì„ ì €ì¥í•˜ê¸°
file_name = "./data/PaulGrahamEssays/worked.txt"
with open(file_name, 'w', encoding="utf-8") as f:
    f.write(response.text)
```


```python
loader = TextLoader(file_name)
doc = loader.load()
print (f"{len(doc)}ê°œì˜ ë¬¸ì„œ")
print (f"ë¬¸ì„œ ë‚´ {len(doc[0].page_content)}ê°œì˜ ë¬¸ì")
```

    1ê°œì˜ ë¬¸ì„œ
    ë¬¸ì„œ ë‚´ 74663ê°œì˜ ë¬¸ì


ì´ì œ ê¸´ ë¬¸ì„œë¥¼ ì‘ì€ ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë³´ê² ìŠµë‹ˆë‹¤.


```python
text_splitter = RecursiveCharacterTextSplitter(chunk_size=3000, chunk_overlap=400)
docs = text_splitter.split_documents(doc)
```


```python
# ë‚˜ì¤‘ì— í‰ê· ì„ ë³¼ ìˆ˜ ìˆë„ë¡ ì´ ë¬¸ì ìˆ˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
num_total_characters = sum([len(x.page_content) for x in docs])

print (f"{len(docs)}ê°œì˜ ë¬¸ì„œì™€ ë¬¸ì„œ ë‚´ {num_total_characters / len(docs):,.0f}ê°œì˜ ë¬¸ì (ì‘ì€ ì¡°ê°)")
```

    29ê°œì˜ ë¬¸ì„œì™€ ë¬¸ì„œ ë‚´ 2,930ê°œì˜ ë¬¸ì (ì‘ì€ ì¡°ê°)



```python
# ì„ë² ë”© ì—”ì§„ì„ ì¤€ë¹„
embeddings = OpenAIEmbeddings(openai_api_key=openai_api_key)

# ë¬¸ì„œë¥¼ ì‚½ì…í•˜ê³  DBì˜ ì›ì‹œ í…ìŠ¤íŠ¸ì™€ ê²°í•©í•˜ì„¸ìš”. ì°¸ê³ : OpenAIì— ëŒ€í•œ API í˜¸ì¶œì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
docsearch = FAISS.from_documents(docs, embeddings)
```

ê²€ìƒ‰ ì—”ì§„ ë§Œë“¤ê¸°


```python
qa = RetrievalQA.from_chain_type(llm=llm, chain_type="stuff", retriever=docsearch.as_retriever())
```

ì´ì œ ì§ˆë¬¸ì„ í•  ì‹œê°„ì…ë‹ˆë‹¤. ê²€ìƒ‰ìëŠ” ìœ ì‚¬í•œ ë¬¸ì„œë¥¼ ê°€ì ¸ì˜¤ê³  LLMì´ ì¶”ë¡ í•  ìˆ˜ ìˆë„ë¡ ê·€í•˜ì˜ ì§ˆë¬¸ê³¼ ê²°í•©í•©ë‹ˆë‹¤.

ì°¸ê³ : ë³„ ê²ƒ ì•„ë‹Œ ê²ƒì²˜ëŸ¼ ë³´ì¼ ìˆ˜ë„ ìˆì§€ë§Œ ì—¬ê¸°ì„œ ë†€ë¼ìš´ ì ì€ ì „ì²´ ì›ë³¸ ë¬¸ì„œë¥¼ ì „ë‹¬í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.


```python
query = "What does the author describe as good work?"
qa.run(query)
```




    ' The author describes painting as good work.'




```python
query = "ì‘ê°€ëŠ” ì¢‹ì€ ì‘í’ˆì„ ë¬´ì—‡ìœ¼ë¡œ ë¬˜ì‚¬í•©ë‹ˆê¹Œ?"
qa.run(query)
```




    ' The author describes good works as paintings.'



ë” ë§ì€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ì´ë¥¼ í´ë¼ìš°ë“œ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ê³ , Metalê³¼ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ê³ , ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œ ê´€ë¦¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”.

## 6. ì¶”ì¶œ (Extraction)
*[LangChain ì¶”ì¶œ ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/extraction.html{:target="_blank"}*

ì¶”ì¶œì€ í…ìŠ¤íŠ¸ì—ì„œ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ì´ëŠ” ì£¼ë¡œ ë°ì´í„°ë¥¼ *êµ¬ì¡°í™”*í•˜ê¸° ìœ„í•´ ì¶œë ¥ íŒŒì‹±ê³¼ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - [í…ìŠ¤íŠ¸ì—ì„œ ë°ì´í„° ì¶”ì¶œì„ ìœ„í•œ LLMs ì‚¬ìš© (ì „ë¬¸ê°€ ìˆ˜ì¤€ì˜ í…ìŠ¤íŠ¸ ì¶”ì¶œ)](https://youtu.be/xZzvwR9jdPA){:target="_blank"}, [OpenAIë¡œë¶€í„° êµ¬ì¡°í™”ëœ ì¶œë ¥ ì–»ê¸° (ë”ëŸ¬ìš´ ë°ì´í„° ì •ë¦¬í•˜ê¸°)](https://youtu.be/KwAXfey-xQk){:target="_blank"}
* **ì˜ˆì‹œ** - [OpeningAttributes](https://twitter.com/GregKamradt/status/1646500373837008897){:target="_blank"}
* **ì‚¬ìš© ì‚¬ë¡€:** ë¬¸ì¥ì—ì„œ êµ¬ì¡°í™”ëœ í–‰ì„ ì¶”ì¶œí•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì‚½ì…, ê¸´ ë¬¸ì„œì—ì„œ ì—¬ëŸ¬ í–‰ì„ ì¶”ì¶œí•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì‚½ì…, ì‚¬ìš©ì ì¿¼ë¦¬ì—ì„œ ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì¶”ì¶œí•˜ì—¬ API í˜¸ì¶œ ìˆ˜í–‰

ì¶”ì¶œì„ ìœ„í•œ ì¸ê¸° ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” [Kor](https://eyurtsev.github.io/kor/){:target="_blank"}ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ì€ ë‹¤ë£¨ì§€ ì•Šê² ì§€ë§Œ, ê³ ê¸‰ ì¶”ì¶œì„ ìœ„í•´ í™•ì¸í•´ ë³´ëŠ” ê²ƒì„ ê°•ë ¥íˆ ì¶”ì²œí•©ë‹ˆë‹¤.


```python
# ì±„íŒ… ë©”ì„¸ì§€ êµ¬ì„±
from langchain.schema import HumanMessage
from langchain.prompts import PromptTemplate, ChatPromptTemplate, HumanMessagePromptTemplate

# ì±„íŒ… ëª¨ë¸ ì‚¬ìš©. ê¸°ë³¸ê°’ì€ gpt-3.5-turbo
from langchain.chat_models import ChatOpenAI

# ì¶œë ¥ì„ êµ¬ë¬¸ ë¶„ì„í•˜ê³  êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì˜´
from langchain.output_parsers import StructuredOutputParser, ResponseSchema

chat_model = ChatOpenAI(temperature=0, model_name='gpt-3.5-turbo', openai_api_key=openai_api_key)
```

### 1) ê¸°ë³¸ ì¶”ì¶œ

ê°„ë‹¨í•œ ì˜ˆë¡œ ì‹œì‘í•´ë´…ì‹œë‹¤. ì—¬ê¸°ì„œ ì›í•˜ëŠ” ì¶œë ¥ ìœ í˜•ì˜ ì§€ì‹œì‚¬í•­ì„ í¬í•¨í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

```python
instructions = """
ê³¼ì¼ ì´ë¦„ì´ í¬í•¨ëœ ë¬¸ì¥ì´ ì œê³µë˜ë©°, ê³¼ì¼ ì´ë¦„ì„ ì¶”ì¶œí•˜ê³  ì´ëª¨í‹°ì½˜ì„ í• ë‹¹í•©ë‹ˆë‹¤.
Python dictionaryì— ê³¼ì¼ ì´ë¦„ê³¼ ì´ëª¨í‹°ì½˜ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
"""

fruit_names = """
ì‚¬ê³¼, ë°°, ê·¸ë¦¬ê³  í‚¤ìœ„
"""
```


```python
# ê³¼ì¼ ì´ë¦„ê³¼ ì§€ì¹¨ì„ ê²°í•©í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±
prompt = (instructions + fruit_names)

# LLM ì½œ
output = chat_model([HumanMessage(content=prompt)])

print (output.content)
print (type(output.content))
```

    {'ì‚¬ê³¼': 'ğŸ', 'ë°°': 'ğŸ', 'í‚¤ìœ„': 'ğŸ¥'}
    <class 'str'>


íŒŒì´ì¬ Dictionaryë¡œ ë³€í™˜


```python
output_dict = eval(output.content)

print (output_dict)
print (type(output_dict))
```

    {'ì‚¬ê³¼': 'ğŸ', 'ë°°': 'ğŸ', 'í‚¤ìœ„': 'ğŸ¥'}
    <class 'dict'>


ì´ë²ˆì—ëŠ” ì´ê²ƒì´ íš¨ê³¼ê°€ ìˆì—ˆì§€ë§Œ ê³ ê¸‰ ì‚¬ìš© ì‚¬ë¡€ì—ì„œëŠ” ì¥ê¸°ì ìœ¼ë¡œ ë³´ì•˜ì„ë•Œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì•„ë‹™ë‹ˆë‹¤.

### 2) LangChainì˜ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì‚¬ìš©í•˜ê¸°

LangChainì˜ ì‘ë‹µ ìŠ¤í‚¤ë§ˆëŠ” ìš°ë¦¬ì—ê²Œ ë‘ ê°€ì§€ë¥¼ í•´ì¤ë‹ˆë‹¤:

1. ì§„ì •í•œ í˜•ì‹ì˜ ì§€ì‹œì‚¬í•­ê³¼ í•¨ê»˜ í”„ë¡¬í”„íŠ¸ë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤. ì´ê²ƒì€ ë‚˜ë¡œì„œëŠ” í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì¸¡ë©´ì— ëŒ€í•´ ê±±ì •í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì¢‹ìŠµë‹ˆë‹¤. ê·¸ ë¶€ë¶„ì€ LangChainì— ë§¡ê¸¸ê²Œìš”!

2. LLMì˜ ì¶œë ¥ì„ ì½ê³  ì´ë¥¼ ì œëŒ€ë¡œ ëœ íŒŒì´ì¬ ê°ì²´ë¡œ ë³€í™˜í•´ ì¤ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ì›í•˜ëŠ” ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ìœ ì‚¬ ì±„íŒ… ë©”ì‹œì§€ì—ì„œ ì‚¬ìš©ìê°€ ì¬ìƒí•˜ê³  ì‹¶ì–´í•˜ëŠ” ë…¸ë˜ì™€ ì•„í‹°ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ë ¤ê³  í•©ë‹ˆë‹¤.


```python
# ë‚´ê°€ ì›í•˜ëŠ” ì•„ì›ƒí’‹ ìŠ¤í‚¤ë§ˆ
response_schemas = [
    ResponseSchema(name="ì•„í‹°ìŠ¤íŠ¸", description="ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„"),
    ResponseSchema(name="ë…¸ë˜", description="ì•„í‹°ìŠ¤íŠ¸ê°€ ì—°ì£¼í•˜ëŠ” ë…¸ë˜ì˜ ì´ë¦„")
]

# ë‚´ ìŠ¤í‚¤ë§ˆì—ì„œ LLM ì¶œë ¥ì„ ì°¾ì•„ ë‹¤ì‹œ ë°˜í™˜í•˜ëŠ” íŒŒì„œ
output_parser = StructuredOutputParser.from_response_schemas(response_schemas)
```


```python
# LangChainì´ ë§Œë“œëŠ” í˜•ì‹ ì§€ì¹¨ì…
format_instructions = output_parser.get_format_instructions()
print(format_instructions)
```

    The output should be a markdown code snippet formatted in the following schema, including the leading and trailing "```json" and "```":
    
    ```json
    {
    	"ì•„í‹°ìŠ¤íŠ¸": string  // ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„
    	"ë…¸ë˜": string  // ì•„í‹°ìŠ¤íŠ¸ê°€ ì—°ì£¼í•˜ëŠ” ë…¸ë˜ì˜ ì´ë¦„
    }
    ```



```python
# ëª¨ë“  ê²ƒì„ í•˜ë‚˜ë¡œ ë¬¶ëŠ” í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
# ì°¸ê³ : ì±„íŒ… ëª¨ë¸ì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì´ì „ê³¼ ë‹¤ë¥¸ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì…ë‹ˆë‹¤.

prompt = ChatPromptTemplate(
    messages=[
        HumanMessagePromptTemplate.from_template("ì‚¬ìš©ìì˜ ëª…ë ¹ì— ë”°ë¼ ì•„í‹°ìŠ¤íŠ¸ì™€ ê³¡ëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.\n \
                                                    {format_instructions}\n{user_prompt}")  
    ],
    input_variables=["user_prompt"],
    partial_variables={"format_instructions": format_instructions}
)
```


```python
fruit_query = prompt.format_prompt(user_prompt="ë‚˜ëŠ” ì‹ í•´ì² ì˜ ë¼ì  ì¹´ë¥¼ ì¢‹ì•„í•´ìš”.")
print (fruit_query.messages[0].content)
```

    ì‚¬ìš©ìì˜ ëª…ë ¹ì— ë”°ë¼ ì•„í‹°ìŠ¤íŠ¸ì™€ ê³¡ëª…ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.
                                                         The output should be a markdown code snippet formatted in the following schema, including the leading and trailing "```json" and "```":
    
    ```json
    {
    	"ì•„í‹°ìŠ¤íŠ¸": string  // ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„
    	"ë…¸ë˜": string  // ì•„í‹°ìŠ¤íŠ¸ê°€ ì—°ì£¼í•˜ëŠ” ë…¸ë˜ì˜ ì´ë¦„
    }
    ```
    ë‚˜ëŠ” ì‹ í•´ì² ì˜ ë¼ì  ì¹´ë¥¼ ì¢‹ì•„í•´ìš”.



```python
fruit_output = chat_model(fruit_query.to_messages())
output = output_parser.parse(fruit_output.content)

print (output)
print (type(output))
```

    {'ì•„í‹°ìŠ¤íŠ¸': 'ì‹ í•´ì² ', 'ë…¸ë˜': 'ë¼ì  ì¹´'}
    <class 'dict'>


ë©‹ì§€ë„¤ìš”. ì´ì œ ë‚˜ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‚¬ì „ì´ ìƒê²¼ìŠµë‹ˆë‹¤.

<span style="Background:#fff5d6">ê²½ê³ :</span> íŒŒì„œëŠ” íŠ¹ì • í˜•ì‹ì˜ LLM ì¶œë ¥ì„ ì°¾ìŠµë‹ˆë‹¤. ê·€í•˜ì˜ ëª¨ë¸ì€ ë§¤ë²ˆ ë™ì¼í•œ í˜•ì‹ì„ ì¶œë ¥í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²ƒìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•˜ì‹­ì‹œì˜¤. GPT4 ë° í–¥í›„ ë°˜ë³µì€ ë”ìš± ì•ˆì •ì ì¼ ê²ƒì…ë‹ˆë‹¤.

ê³ ê¸‰ êµ¬ë¬¸ ë¶„ì„ì— ëŒ€í•´ì„œëŠ” [Kor](https://eyurtsev.github.io/kor/){:target="_blank"}ë¥¼ í™•ì¸í•˜ì„¸ìš”.

## 7. í‰ê°€ (Evaluation)

*[LangChain í‰ê°€ ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/evaluation.html){:target="_blank"}*

í‰ê°€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¶œë ¥ì— ëŒ€í•œ í’ˆì§ˆ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ì¼ë°˜ì ì¸, ê²°ì •ì ì¸ ì½”ë“œì—ëŠ” ìš°ë¦¬ê°€ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í…ŒìŠ¤íŠ¸ê°€ ìˆì§€ë§Œ, ìì—°ì–´ì˜ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±ê³¼ ë‹¤ì–‘ì„± ë•Œë¬¸ì— LLMsì˜ ì¶œë ¥ì„ íŒë‹¨í•˜ëŠ” ê²ƒì€ ë” ì–´ë µìŠµë‹ˆë‹¤. LangChainì€ ì´ ì—¬ì •ì—ì„œ ìš°ë¦¬ë¥¼ ë•ëŠ” ë„êµ¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - ê³§ ì¶œì‹œ ì˜ˆì •
* **ì˜ˆì‹œ** - [Lance Martinì˜ ê³ ê¸‰](https://twitter.com/RLanceMartin){:target="_blank"} [ìë™ í‰ê°€ê¸°](https://github.com/rlancemartin/auto-evaluator){:target="_blank"}
* **ì‚¬ìš© ì‚¬ë¡€:** ìš”ì•½ ë˜ëŠ” ì§ˆë¬¸ & ë‹µë³€ íŒŒì´í”„ë¼ì¸ì— ëŒ€í•œ í’ˆì§ˆ ê²€ì‚¬ë¥¼ ì‹¤í–‰í•˜ê±°ë‚˜, ìš”ì•½ íŒŒì´í”„ë¼ì¸ì˜ ì¶œë ¥ì„ í™•ì¸í•©ë‹ˆë‹¤.


```python
# Embeddings, store, and retrieval
from langchain.embeddings.openai import OpenAIEmbeddings
from langchain.vectorstores import FAISS
from langchain.chains import RetrievalQA

# Model and doc loader
from langchain import OpenAI
from langchain.document_loaders import TextLoader

# Eval!
from langchain.evaluation.qa import QAEvalChain

llm = OpenAI(temperature=0, openai_api_key=openai_api_key)
```


```python
import requests

url = "https://raw.githubusercontent.com/hmkim312/datas/main/Langchain/worked.txt"
response = requests.get(url)

# íŒŒì¼ì„ ì €ì¥í•˜ê¸°
file_name = "./data/PaulGrahamEssays/worked.txt"
with open(file_name, 'w', encoding="utf-8") as f:
    f.write(response.text)
```


```python
# ê¸´ ë¬¸ìƒì˜ ì—ì„¸ì´ ë‹¤ìš´
loader = TextLoader('./data/PaulGrahamEssays/worked.txt')
doc = loader.load()

print (f"{len(doc)}ê°œì˜ ë¬¸ì„œ")
print (f"ë¬¸ì„œ ë‚´ì˜ {len(doc[0].page_content)}ê°œì˜ ë¬¸ì")
```

    1ê°œì˜ ë¬¸ì„œ
    ë¬¸ì„œ ë‚´ì˜ 74663ê°œì˜ ë¬¸ì


ë¨¼ì € ë²¡í„°ìŠ¤í† ì–´ ëŒ„ìŠ¤ë¥¼ í•´ì„œ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.


```python
text_splitter = RecursiveCharacterTextSplitter(chunk_size=3000, chunk_overlap=400)
docs = text_splitter.split_documents(doc)

# ë‚˜ì¤‘ì— í‰ê· ì„ ë³¼ ìˆ˜ ìˆë„ë¡ ì´ ë¬¸ì ìˆ˜ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
num_total_characters = sum([len(x.page_content) for x in docs])

print (f"{len(docs)}ê°œì˜ ë¬¸ì„œì™€ {num_total_characters / len(docs):,.0f}ê°œì˜ í‰ê·  ë¬¸ì (ì‘ì€ ì¡°ê°)")
```

    29ê°œì˜ ë¬¸ì„œì™€ 2,930ê°œì˜ í‰ê·  ë¬¸ì (ì‘ì€ ì¡°ê°)



```python
# ì„ë² ë”© ë° ë¬¸ì„œ ì €ì¥ì†Œ
embeddings = OpenAIEmbeddings(openai_api_key=openai_api_key)
docsearch = FAISS.from_documents(docs, embeddings)
```

ê²€ìƒ‰ ì²´ì¸ì„ ë§Œë“œì„¸ìš”. ì´ì œ `input_key` ë§¤ê°œë³€ìˆ˜ê°€ ì–´ë–»ê²Œ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. ì´ëŠ” ë‚´ê°€ ì œê³µí•œ ì‚¬ì „ì˜ ì–´ë–¤ í‚¤ì— í”„ë¡¬í”„íŠ¸/ì¿¼ë¦¬ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ì²´ì¸ì— ì•Œë ¤ì¤ë‹ˆë‹¤. ì•„ë˜ ì‚¬ì „ì˜ ì§ˆë¬¸ê³¼ ì¼ì¹˜í•˜ë„ë¡ 'ì§ˆë¬¸'ì„ ì§€ì •í•©ë‹ˆë‹¤.


```python
chain = RetrievalQA.from_chain_type(llm=llm, chain_type="stuff", retriever=docsearch.as_retriever(), input_key="question")
```

ì´ì œ ë‚´ê°€ ì˜³ë‹¤ê³  ìƒê°í•˜ëŠ” ì§ˆë¬¸ ëª©ë¡ê³¼ ì‹¤ì œ ë‹µë³€ì„ LLMì— ì „ë‹¬í•˜ê² ìŠµë‹ˆë‹¤.


```python
question_answers = [
    {'question' : "ì¹œêµ¬ê°€ ì§ì ‘ ë§Œë“  ë§ˆì´í¬ë¡œì»´í“¨í„° í‚¤íŠ¸ë¥¼ íŒë§¤í•œ íšŒì‚¬ëŠ” ì–´ë””ì¸ê°€ìš”?", 'answer' : 'Healthkit'},
    {'question' : "ë¯¸êµ­ì˜ ê¸ˆìœµ ìˆ˜ë„ì¸ ë„ì‹œì—ì„œ ê·¸ê°€ ì´ì•¼ê¸°í•œ ì‘ì€ ë„ì‹œëŠ” ë¬´ì—‡ì´ì—ˆì„ê¹Œìš”?", 'answer' : 'ìš”í¬ë¹Œ'}
]
```

ë‚˜ëŠ” `chain.apply`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘ ì§ˆë¬¸ì„ í•˜ë‚˜ì”© ê°œë³„ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê² ìŠµë‹ˆë‹¤.

ë©‹ì§„ ë¶€ë¶„ ì¤‘ í•˜ë‚˜ëŠ” ì§ˆë¬¸ ë° ë‹µë³€ ì‚¬ì „ ëª©ë¡ì„ ë‹¤ì‹œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‚¬ì „ 'result'ì—ëŠ” LLMì˜ ì¶œë ¥ì´ ë  ë˜ ë‹¤ë¥¸ í‚¤ê°€ ìˆìŠµë‹ˆë‹¤.

ì°¸ê³ : íŠ¹íˆ ë‘ ë²ˆì§¸ ì§ˆë¬¸ì„ ëª¨í˜¸í•˜ê³  í•œ ë²ˆì— ë‹µë³€í•˜ê¸° ì–´ë µê²Œ ë§Œë“¤ì–´ LLMì´ í‹€ë¦¬ê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.


```python
predictions = chain.apply(question_answers)
predictions
```




    [{'question': 'ì¹œêµ¬ê°€ ì§ì ‘ ë§Œë“  ë§ˆì´í¬ë¡œì»´í“¨í„° í‚¤íŠ¸ë¥¼ íŒë§¤í•œ íšŒì‚¬ëŠ” ì–´ë””ì¸ê°€ìš”?',
      'answer': 'Healthkit',
      'result': ' Heathkit'},
     {'question': 'ë¯¸êµ­ì˜ ê¸ˆìœµ ìˆ˜ë„ì¸ ë„ì‹œì—ì„œ ê·¸ê°€ ì´ì•¼ê¸°í•œ ì‘ì€ ë„ì‹œëŠ” ë¬´ì—‡ì´ì—ˆì„ê¹Œìš”?',
      'answer': 'ìš”í¬ë¹Œ',
      'result': ' New York'}]



ê·¸ëŸ° ë‹¤ìŒ LLMì´ ë‚´ ì •ë‹µ('result' í‚¤)ì„ LLMì˜ ê²°ê³¼('result' í‚¤)ì™€ ë¹„êµí•˜ë„ë¡ í•©ë‹ˆë‹¤.

ì•„ë‹ˆë©´ ê°„ë‹¨íˆ ë§í•´ì„œ LLMì´ ìŠ¤ìŠ¤ë¡œ ì±„ì í•˜ë„ë¡ ìš”ì²­í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


```python
# í‰ê°€ ì‹œì‘
eval_chain = QAEvalChain.from_llm(llm)

# ìì²´ì ìœ¼ë¡œ ë“±ê¸‰ì„ ë§¤ê¸°ì‹­ì‹œì˜¤. ì•„ë˜ ì½”ë“œëŠ” eval_chainì´ ë‹¤ë¥¸ ë¶€ë¶„ì˜ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
graded_outputs = eval_chain.evaluate(question_answers,
                                     predictions,
                                     question_key="question",
                                     prediction_key="result",
                                     answer_key='answer')
```


```python
graded_outputs
```




    [{'results': ' CORRECT'}, {'results': ' INCORRECT'}]



ì´ê²ƒì´ ë§ìŠµë‹ˆë‹¤! ì§ˆë¬¸1ì˜ ëŒ€ë‹µì€ "Healthkit"ì´ì—ˆê³  ì˜ˆì¸¡ì€ "ë§ˆì´í¬ë¡œì»´í“¨í„° í‚¤íŠ¸ëŠ” Heathkitì—ì„œ íŒë§¤í–ˆìŠµë‹ˆë‹¤."ì˜€ìŠµë‹ˆë‹¤. LLMì€ ë‹µë³€ê³¼ ê²°ê³¼ê°€ ë™ì¼í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìš°ë¦¬ì—ê²Œ "CORRECT" ë¼ë²¨ì„ ë¶€ì—¬í–ˆìŠµë‹ˆë‹¤. ì§ˆë¬¸2ì˜ ê²½ìš° ë™ì¼í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ì•Œê³  "INCORRECT" ë ˆì´ë¸”ì„ ì œê³µí–ˆìŠµë‹ˆë‹¤.

## 8. í‘œ ë°ì´í„° ì§ˆì˜í•˜ê¸° (Querying Tabular Data)

*[LangChain í‘œ ë°ì´í„° ì§ˆì˜ ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/tabular.html){:target="_blank"}*

ì„¸ê³„ì—ì„œ ê°€ì¥ ì¼ë°˜ì ì¸ ìœ í˜•ì˜ ë°ì´í„°ëŠ” í‘œ í˜•ì‹ìœ¼ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤ (ë¹„êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ ì œì™¸í•˜ê³ ). ì´ ë°ì´í„°ë¥¼ LangChainìœ¼ë¡œ ì§ˆì˜í•˜ê³  LLMì— ì „ë‹¬í•˜ëŠ” ê²ƒì€ ë§¤ìš° ê°•ë ¥í•©ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - ê³§ ì¶œì‹œ ì˜ˆì •
* **ì˜ˆì‹œ** - ë¯¸ì •
* **ì‚¬ìš© ì‚¬ë¡€:** ì‚¬ìš©ìì— ê´€í•œ ë°ì´í„°ë¥¼ ì§ˆì˜í•˜ê¸° ìœ„í•´ LLMs ì‚¬ìš©, ë°ì´í„° ë¶„ì„ ìˆ˜í–‰, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤ì‹œê°„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°

ë” ìì„¸í•œ ë‚´ìš©ì€ "ì—ì´ì „íŠ¸ + í‘œ ë°ì´í„°" ([Pandas](https://python.langchain.com/en/latest/modules/agents/toolkits/examples/pandas.html){:target="_blank"}, [SQL](https://python.langchain.com/en/latest/modules/agents/toolkits/examples/sql_database.html){:target="_blank"}, [CSV](https://python.langchain.com/en/latest/modules/agents/toolkits/examples/csv.html){:target="_blank"})ë¥¼ í™•ì¸í•˜ì„¸ìš”.

ìì—°ì–´ë¡œ SQLite DBë¥¼ ì§ˆì˜í•´ë´…ì‹œë‹¤. [ìƒŒí”„ë€ì‹œìŠ¤ì½” ë‚˜ë¬´](https://data.sfgov.org/City-Infrastructure/Street-Tree-List/tkzw-k3nq){:target="_blank"} ë°ì´í„°ì…‹ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.


```python
from langchain import OpenAI, SQLDatabase
from langchain_experimental.sql import SQLDatabaseChain

llm = OpenAI(temperature=0, openai_api_key=openai_api_key)
```


ë¨¼ì € ë°ì´í„°ê°€ ìˆëŠ” ìœ„ì¹˜ë¥¼ ì§€ì •í•˜ê³  ì—°ê²°ì„ ì¤€ë¹„í•˜ê² ìŠµë‹ˆë‹¤.


```python
import requests

url = "https://raw.githubusercontent.com/hmkim312/datas/main/Langchain/San_Francisco_Trees.db"

# íŒŒì¼ì„ ì €ì¥í•˜ê¸°
file_name = "data/San_Francisco_Trees.db"
response = requests.get(url)
with open(file_name, 'wb') as f:
    f.write(response.content)
```


```python
sqlite_db_path = "data/San_Francisco_Trees.db"
db = SQLDatabase.from_uri(f"sqlite:///{sqlite_db_path}")
```

ê·¸ëŸ° ë‹¤ìŒ LLMê³¼ DBë¥¼ ì‚¬ìš©í•˜ëŠ” ì²´ì¸ì„ ë§Œë“­ë‹ˆë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆëŠ”ì§€ ë³¼ ìˆ˜ ìˆë„ë¡ `verbose=True`ë¥¼ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.


```python
db_chain = SQLDatabaseChain(llm=llm, database=db, verbose=True)
```

    /home/hyunmin-kim/anaconda3/lib/python3.10/site-packages/langchain_experimental/sql/base.py:75: UserWarning: Directly instantiating an SQLDatabaseChain with an llm is deprecated. Please instantiate with llm_chain argument or using the from_llm class method.
      warnings.warn(



```python
db_chain.run("ìƒŒí”„ë€ì‹œìŠ¤ì½”ì—ëŠ” ëª‡ ì¢…ì˜ ë‚˜ë¬´ê°€ ìˆë‚˜ìš”?")
```

    
    
    [1m> Entering new SQLDatabaseChain chain...[0m
    ìƒŒí”„ë€ì‹œìŠ¤ì½”ì—ëŠ” ëª‡ ì¢…ì˜ ë‚˜ë¬´ê°€ ìˆë‚˜ìš”?
    SQLQuery:[32;1m[1;3mSELECT COUNT(DISTINCT qSpecies) FROM SFTrees;[0m
    SQLResult: [33;1m[1;3m[(578,)][0m
    Answer:[32;1m[1;3mìƒŒí”„ë€ì‹œìŠ¤ì½”ì—ëŠ” 578 ì¢…ì˜ ë‚˜ë¬´ê°€ ìˆìŠµë‹ˆë‹¤.[0m
    [1m> Finished chain.[0m





    'ìƒŒí”„ë€ì‹œìŠ¤ì½”ì—ëŠ” 578 ì¢…ì˜ ë‚˜ë¬´ê°€ ìˆìŠµë‹ˆë‹¤.'



ì •ë§ ëŒ€ë‹¨í•´ìš”! ì‹¤ì œë¡œ ì—¬ê¸°ì—ëŠ” ëª‡ ê°€ì§€ ë‹¨ê³„ê°€ ì§„í–‰ë©ë‹ˆë‹¤.

**ë‹¨ê³„:**
1. ì‚¬ìš©í•  í…Œì´ë¸” ì°¾ê¸°
2. ì‚¬ìš©í•  ì—´ ì°¾ê¸°
3. ì˜¬ë°”ë¥¸ SQL ì¿¼ë¦¬ë¥¼ êµ¬ì„±í•˜ì„¸ìš”.
4. í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
5. ê²°ê³¼ ì–»ê¸°
6. ìì—°ì–´ ì‘ë‹µì„ ë‹¤ì‹œ ë°˜í™˜í•©ë‹ˆë‹¤.

Pandasë¥¼ í†µí•´ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.


```python
import sqlite3
import pandas as pd

# Connect to the SQLite database
connection = sqlite3.connect(sqlite_db_path)

# Define your SQL query
query = "SELECT count(distinct qSpecies) FROM SFTrees"

# Read the SQL query into a Pandas DataFrame
df = pd.read_sql_query(query, connection)

# Close the connection
connection.close()
```


```python
# Display the result in the first column first cell
print(df.iloc[0,0])
```

    578


ì‘ë‹µê³¼ ë™ì¼í•©ë‹ˆë‹¤.

## 9. ì½”ë“œ ì´í•´ (Code Understanding)

*[LangChain ì½”ë“œ ì´í•´ ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/code.html){:target="_blank"}*

LLMsì˜ ê°€ì¥ í¥ë¯¸ë¡œìš´ ëŠ¥ë ¥ ì¤‘ í•˜ë‚˜ëŠ” ì½”ë“œë¥¼ ì´í•´í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì „ ì„¸ê³„ì˜ ì‚¬ëŒë“¤ì´ AIì˜ ë„ì›€ìœ¼ë¡œ ì†ë„ì™€ í’ˆì§ˆ ëª¨ë‘ì—ì„œ ì„±ê³¼ë¥¼ ë†’ì´ê³  ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì˜ í° ë¶€ë¶„ì€ ì½”ë“œë¥¼ ì´í•´í•  ìˆ˜ ìˆëŠ” LLMì„ ê°€ì§€ê³  íŠ¹ì • ì‘ì—…ì„ ë„ì™€ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - ê³§ ì¶œì‹œ ì˜ˆì •
* **ì˜ˆì‹œ** - ë¯¸ì •
* **ì‚¬ìš© ì‚¬ë¡€:** íŠ¹ì • ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œì˜ ì§ˆë¬¸ì— ë‹µì„ í•´ì£¼ê±°ë‚˜ ìƒˆë¡œìš´ ì½”ë“œë¥¼ ìƒì„±í•´ì£¼ëŠ” Co-Pilot ê°™ì€ ê¸°ëŠ¥


```python
import os

# ë²¡í„°
from langchain.vectorstores import FAISS
from langchain.embeddings.openai import OpenAIEmbeddings

# ì²´ì¸ ëª¨ë¸
from langchain.chat_models import ChatOpenAI

# í…ìŠ¤íŠ¸ ë¶„í• ê¸°
from langchain.text_splitter import CharacterTextSplitter
from langchain.document_loaders import TextLoader

llm = ChatOpenAI(model_name='gpt-3.5-turbo', openai_api_key=openai_api_key)
```

ë¨¼ì € ë²¡í„°ìŠ¤í† ì–´ ëŒ„ìŠ¤ë¥¼ í•´ì„œ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ í•  ìˆ˜ ìˆê²Œ í•©ì‹œë‹¤.


```python
embeddings = OpenAIEmbeddings(disallowed_special=(), openai_api_key=openai_api_key)
```

ì´ ì €ì¥ì†Œì˜ ë°ì´í„° í´ë”ì— ì‘ì€ Python íŒ¨í‚¤ì§€ [The Fuzz](https://github.com/seatgeek/thefuzz){:target="_blank"}(ê°œì¸ì´ ì¢‹ì•„í•˜ëŠ” ì¸ë”” íŒ¨í‚¤ì§€)ë¥¼ ë„£ì—ˆìŠµë‹ˆë‹¤.

ì•„ë˜ ë£¨í”„ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê° íŒŒì¼ì„ ì‚´í´ë³´ê³  ë¬¸ì„œë¡œ ë¡œë“œí•©ë‹ˆë‹¤.


```python
# ì‹¤ìŠµì— ì‚¬ìš©ë  The Fuzz íŒ¨í‚¤ì§€ë¥¼ zipìœ¼ë¡œ ì••ì¶•í•˜ì—¬ ë ˆíŒŒì§€í† ë¦¬ì— ì˜¬ë ¤ë†“ìŒ
# ì´ë¥¼ ë‹¤ìš´ ë°›ì•„ ì••ì¶•í•´ì œí•˜ëŠ” ì½”ë“œ ì‹œê°„ì´ ì¢€ ê±¸ë¦¼
# ê¸°ì¡´ì— í•´ë‹¹ íŒ¨í‚¤ì§€ê°€ ìˆìœ¼ë©´ ì‚­ì œí•˜ê³  ì§„í–‰
import requests
import zipfile
import os

def download_and_extract_zip(zip_url, save_path, extract_path):
    # ZIP íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    response = requests.get(zip_url)
    zip_filename = os.path.join(save_path, "temp.zip")
    with open(zip_filename, 'wb') as zip_file:
        zip_file.write(response.content)
    
    # ZIP íŒŒì¼ ì••ì¶• í•´ì œ
    with zipfile.ZipFile(zip_filename, 'r') as zip_ref:
        zip_ref.extractall(extract_path)
    
    # ì„ì‹œ ZIP íŒŒì¼ ì‚­ì œ
    os.remove(zip_filename)

# file down
zip_url = "https://raw.githubusercontent.com/hmkim312/datas/main/Langchain/thefuzz.zip"
save_path = "./"  # ZIP íŒŒì¼ì„ ì„ì‹œë¡œ ì €ì¥í•  ê²½ë¡œ
extract_path = "./data/"  # ì••ì¶•ì„ í’€ ë””ë ‰í† ë¦¬
download_and_extract_zip(zip_url, save_path, extract_path)
```


```python
root_dir = './data/thefuzz'
docs = []

# í´ë” í™•ì¸
for dirpath, dirnames, filenames in os.walk(root_dir):
    
    # íŒŒì¼ í™•ì¸
    for file in filenames:
        try: 
            # íŒŒì¼ì„ ë¬¸ì„œë¡œ ë¡œë“œí•˜ê³  ë¶„í• í•©ë‹ˆë‹¤.
            loader = TextLoader(os.path.join(dirpath, file), encoding='utf-8')
            docs.extend(loader.load_and_split())
        except Exception as e: 
            pass
```

ë¬¸ì„œì˜ ì˜ˆë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ê·¸ëƒ¥, íŒ¨í‚¤ì§€ ë‚´ ë¬¸ì„œì¼ ë¿ì…ë‹ˆë‹¤.


```python
print (f"{len(docs)}ê°œì˜ ë¬¸ì„œ\n")
print ("------ ì‹œì‘ ë¬¸ì„œ ------")
print (docs[0].page_content[:300])
```

    175ê°œì˜ ë¬¸ì„œ
    
    ------ ì‹œì‘ ë¬¸ì„œ ------
    Changelog
    =========
    
    0.17.0 (2018-08-20)
    -------------------
    
    - Make benchmarks script Py3 compatible. [Stefan Behnel]
    
    - Add Go lang port. [iddober]
    
    - Add reference to C# port. [ericcoleman]
    
    - Chore: remove license header from files. [Jose Diaz-Gonzalez]
    
      The files should all inherit the projec


docstoreì— ì‚½ì…í•˜ê³  ì €ì¥í•˜ì„¸ìš”. ê·¸ëŸ¬ë©´ OpenAIì— ëŒ€í•œ API í˜¸ì¶œì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.


```python
docsearch = FAISS.from_documents(docs, embeddings)
```


```python
# Get our retriever ready
qa = RetrievalQA.from_chain_type(llm=llm, chain_type="stuff", retriever=docsearch.as_retriever())
```


```python
query = "ëª©ë¡ì—ì„œ ê°€ì¥ ìœ ì‚¬í•œê²ƒì„ ì°¾ìœ¼ë ¤ë©´ ì–´ë–¤ ê¸°ëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆê¹Œ?"
output = qa.run(query)
```


```python
print(output)
```

    ê°€ì¥ ìœ ì‚¬í•œ ê²ƒì„ ì°¾ê¸° ìœ„í•´ì„œëŠ” ë¬¸ìì—´ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì•Œê³ ë¦¬ì¦˜ì€ ì£¼ì–´ì§„ ë¬¸ìì—´ê³¼ ë‹¤ë¥¸ ë¬¸ìì—´ë“¤ì„ ë¹„êµí•˜ì—¬ ìœ ì‚¬ë„ë¥¼ ì¸¡ì •í•˜ê³ , ê°€ì¥ ìœ ì‚¬í•œ ë¬¸ìì—´ì„ ì°¾ì•„ì¤ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œëŠ” fuzz ëª¨ë“ˆì˜ extractOne() í•¨ìˆ˜ë‚˜ process ëª¨ë“ˆì˜ extractOne() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ë“¤ì€ ì£¼ì–´ì§„ ì¿¼ë¦¬ì™€ ì„ íƒì§€ë“¤ì„ ë¹„êµí•˜ì—¬ ê°€ì¥ ìœ ì‚¬í•œ ì„ íƒì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.



```python
query = "process.extractOne()ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œ ì‘ì„±í•´ì¤˜"
output = qa.run(query)
```


```python
print(output)
```

    ì•„ë˜ëŠ” process.extractOne()ì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ ì½”ë“œì…ë‹ˆë‹¤.
    
    ```python
    from fuzzywuzzy import process
    
    choices = [
        "new york mets vs chicago cubs",
        "chicago cubs at new york mets",
        "atlanta braves vs pittsburgh pirates",
        "new york yankees vs boston red sox"
    ]
    
    query = "new york mets at chicago cubs"
    
    best = process.extractOne(query, choices)
    print(best[0])
    ```
    
    ìœ„ì˜ ì½”ë“œëŠ” `query`ì™€ ê°€ì¥ ìœ ì‚¬í•œ í•­ëª©ì„ `choices`ì—ì„œ ì°¾ì•„ì„œ ë°˜í™˜í•©ë‹ˆë‹¤. ë°˜í™˜ëœ ê²°ê³¼ëŠ” íŠœí”Œë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë©°, ì²« ë²ˆì§¸ ìš”ì†ŒëŠ” ê°€ì¥ ìœ ì‚¬í•œ í•­ëª©ì´ê³  ë‘ ë²ˆì§¸ ìš”ì†ŒëŠ” ì¼ì¹˜ìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ìœ„ì˜ ì½”ë“œì—ì„œëŠ” "new york mets vs chicago cubs"ê°€ ê°€ì¥ ìœ ì‚¬í•œ í•­ëª©ì´ë¯€ë¡œ í•´ë‹¹ í•­ëª©ì´ ì¶œë ¥ë©ë‹ˆë‹¤.


## 10. APIì™€ì˜ ìƒí˜¸ì‘ìš© (Interacting with APIs)

*[LangChain API ìƒí˜¸ì‘ìš© ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/apis.html){:target="_blank"}*

í•„ìš”í•œ ë°ì´í„°ë‚˜ ì‘ì—…ì´ API ë’¤ì— ìˆë‹¤ë©´, LLMì„ ì‚¬ìš©í•˜ì—¬ APIì™€ ìƒí˜¸ì‘ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - ê³§ ì¶œì‹œ ì˜ˆì •
* **ì˜ˆì‹œ** - ë¯¸ì •
* **ì‚¬ìš© ì‚¬ë¡€:** ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì´í•´í•˜ê³  ì‘ì—…ì„ ìˆ˜í–‰í•˜ê±°ë‚˜, ë” ë§ì€ ì‹¤ì œ ì‘ì—… íë¦„ì„ ìë™í™”í•˜ê¸°

ì´ ì£¼ì œëŠ” ì—ì´ì „íŠ¸ì™€ í”ŒëŸ¬ê·¸ì¸ê³¼ ë°€ì ‘í•˜ê²Œ ê´€ë ¨ë˜ì–´ ìˆì§€ë§Œ, ì´ ì„¹ì…˜ì—ì„œëŠ” ì´ì— ëŒ€í•œ ê°„ë‹¨í•œ ì‚¬ìš© ì‚¬ë¡€ë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [LangChain + í”ŒëŸ¬ê·¸ì¸](https://python.langchain.com/en/latest/use_cases/agents/custom_agent_with_plugin_retrieval_using_plugnplai.html){:target="_blank"} ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.



```python
from langchain.chains import APIChain
from langchain.llms import OpenAI

llm = OpenAI(temperature=0, openai_api_key=openai_api_key, model_name="gpt-3.5-turbo-16k")
```

LangChainì˜ APIChainì—ëŠ” API ë¬¸ì„œë¥¼ ì½ê³  ì–´ë–¤ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ëŠ”ì§€ ì´í•´í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.

ì´ ê²½ìš°ì—ëŠ” ì´ê²ƒì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë³´ì—¬ì£¼ê¸° ìœ„í•´ (ì˜ë„ì ìœ¼ë¡œ ì—‰ì„±í•œ) API ë¬¸ì„œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.


```python
api_docs = """

BASE URL: https://restcountries.com/

API ì—”ë“œí¬ì¸íŠ¸ /v3.1/name/{name} êµ­ê°€ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ëª¨ë“  URL ë§¤ê°œë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
    - ì´ë¦„: êµ­ê°€ ì´ë¦„ - ì˜ˆ: ì´íƒˆë¦¬ì•„, í”„ë‘ìŠ¤
    
API ì—”ë“œí¬ì¸íŠ¸ /v3.1/currency/{currency}ëŠ” ì§€ì—­ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ëª¨ë“  URL ë§¤ê°œë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
    - í†µí™”: 3ê¸€ì í†µí™”. ì˜ˆ: USD, COP
"""

chain_new = APIChain.from_llm_and_api_docs(llm, api_docs, verbose=True)
```

êµ­ê°€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìœ„í•œ API í˜¸ì¶œì„ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.


```python
chain_new.run('South Koreaì˜ ì •ë³´ë¥¼ ì•Œë ¤ì¤„ë˜')
```

    
    
    [1m> Entering new APIChain chain...[0m
    [32;1m[1;3mhttps://restcountries.com/v3.1/name/South%20Korea?lang=ko[0m
    [33;1m[1;3m[{"name":{"common":"South Korea","official":"Republic of Korea","nativeName":{"kor":{"official":"ëŒ€í•œë¯¼êµ­","common":"í•œêµ­"}}},"tld":[".kr",".í•œêµ­"],"cca2":"KR","ccn3":"410","cca3":"KOR","cioc":"KOR","independent":true,"status":"officially-assigned","unMember":true,"currencies":{"KRW":{"name":"South Korean won","symbol":"â‚©"}},"idd":{"root":"+8","suffixes":["2"]},"capital":["Seoul"],"altSpellings":["KR","Korea, Republic of","Republic of Korea","ë‚¨í•œ","ë‚¨ì¡°ì„ "],"region":"Asia","subregion":"Eastern Asia","languages":{"kor":"Korean"},"translations":{"ara":{"official":"Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© ÙƒÙˆØ±ÙŠØ§","common":"ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©"},"bre":{"official":"Republik Korea","common":"Korea ar Su"},"ces":{"official":"KorejskÃ¡ republika","common":"JiÅ¾nÃ­ Korea"},"cym":{"official":"Republic of Korea","common":"South Korea"},"deu":{"official":"Republik Korea","common":"SÃ¼dkorea"},"est":{"official":"Korea Vabariik","common":"LÃµuna-Korea"},"fin":{"official":"Korean tasavalta","common":"EtelÃ¤-Korea"},"fra":{"official":"RÃ©publique de CorÃ©e","common":"CorÃ©e du Sud"},"hrv":{"official":"Republika Koreja","common":"JuÅ¾na Koreja"},"hun":{"official":"Koreai KÃ¶ztÃ¡rsasÃ¡g","common":"DÃ©l-Korea"},"ita":{"official":"Repubblica di Corea","common":"Corea del Sud"},"jpn":{"official":"å¤§éŸ“æ°‘å›½","common":"éŸ“å›½"},"kor":{"official":"ëŒ€í•œë¯¼êµ­","common":"í•œêµ­"},"nld":{"official":"Republiek Korea","common":"Zuid-Korea"},"per":{"official":"Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ú©Ø±Ù‡","common":"Ú©Ø±Ù‡Ù” Ø¬Ù†ÙˆØ¨ÛŒ"},"pol":{"official":"Republika Korei","common":"Korea PoÅ‚udniowa"},"por":{"official":"RepÃºblica da Coreia","common":"Coreia do Sul"},"rus":{"official":"Ğ ĞµÑĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ° ĞšĞ¾Ñ€ĞµÑ","common":"Ğ®Ğ¶Ğ½Ğ°Ñ ĞšĞ¾Ñ€ĞµÑ"},"slk":{"official":"KÃ³rejskÃ¡ republika","common":"JuÅ¾nÃ¡ KÃ³rea"},"spa":{"official":"RepÃºblica de Corea","common":"Corea del Sur"},"srp":{"official":"Ğ ĞµĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ° ĞšĞ¾Ñ€ĞµÑ˜Ğ°","common":"ĞˆÑƒĞ¶Ğ½Ğ° ĞšĞ¾Ñ€ĞµÑ˜Ğ°"},"swe":{"official":"Republiken Korea","common":"Sydkorea"},"tur":{"official":"Kore Cumhuriyeti","common":"GÃ¼ney Kore"},"urd":{"official":"Ø¬Ù…ÛÙˆØ±ÛŒÛ Ú©ÙˆØ±ÛŒØ§ ","common":"Ø¬Ù†ÙˆØ¨ÛŒ Ú©ÙˆØ±ÛŒØ§"},"zho":{"official":"å¤§éŸ©æ°‘å›½","common":"éŸ©å›½"}},"latlng":[37.0,127.5],"landlocked":false,"borders":["PRK"],"area":100210.0,"demonyms":{"eng":{"f":"South Korean","m":"South Korean"},"fra":{"f":"Sud-corÃ©enne","m":"Sud-corÃ©en"}},"flag":"\uD83C\uDDF0\uD83C\uDDF7","maps":{"googleMaps":"https://goo.gl/maps/7ecjaJXefjAQhxjGA","openStreetMaps":"https://www.openstreetmap.org/relation/307756"},"population":51780579,"gini":{"2016":31.4},"fifa":"KOR","car":{"signs":["ROK"],"side":"right"},"timezones":["UTC+09:00"],"continents":["Asia"],"flags":{"png":"https://flagcdn.com/w320/kr.png","svg":"https://flagcdn.com/kr.svg","alt":"The flag of South Korea has a white field, at the center of which is a red and blue Taegeuk circle surrounded by four black trigrams, one in each corner."},"coatOfArms":{"png":"https://mainfacts.com/media/images/coats_of_arms/kr.png","svg":"https://mainfacts.com/media/images/coats_of_arms/kr.svg"},"startOfWeek":"monday","capitalInfo":{"latlng":[37.55,126.98]},"postalCode":{"format":"SEOUL ###-###","regex":"^(?:SEOUL)*(\\d{6})$"}}][0m
    
    [1m> Finished chain.[0m





    "South Korea, officially known as the Republic of Korea, is a country located in Eastern Asia. The official language is Korean. The currency used is the South Korean won (KRW). The capital city is Seoul. South Korea is a member of the United Nations and has a population of approximately 51.8 million people. The country's flag consists of a white field with a red and blue Taegeuk circle surrounded by four black trigrams. The country's coat of arms can be found at the provided URL."



í†µí™” ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìœ„í•œ API í˜¸ì¶œì„ ì‹œë„í•´ ë³´ê² ìŠµë‹ˆë‹¤.


```python
chain_new.run('KRW í†µí™”ì— ëŒ€í•´ ì•Œë ¤ì¤„ìˆ˜ ìˆë‚˜ìš”?')
```

    
    
    [1m> Entering new APIChain chain...[0m
    [32;1m[1;3mhttps://restcountries.com/v3.1/currency/KRW[0m
    [33;1m[1;3m[{"name":{"common":"South Korea","official":"Republic of Korea","nativeName":{"kor":{"official":"ëŒ€í•œë¯¼êµ­","common":"í•œêµ­"}}},"tld":[".kr",".í•œêµ­"],"cca2":"KR","ccn3":"410","cca3":"KOR","cioc":"KOR","independent":true,"status":"officially-assigned","unMember":true,"currencies":{"KRW":{"name":"South Korean won","symbol":"â‚©"}},"idd":{"root":"+8","suffixes":["2"]},"capital":["Seoul"],"altSpellings":["KR","Korea, Republic of","Republic of Korea","ë‚¨í•œ","ë‚¨ì¡°ì„ "],"region":"Asia","subregion":"Eastern Asia","languages":{"kor":"Korean"},"translations":{"ara":{"official":"Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© ÙƒÙˆØ±ÙŠØ§","common":"ÙƒÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ù†ÙˆØ¨ÙŠØ©"},"bre":{"official":"Republik Korea","common":"Korea ar Su"},"ces":{"official":"KorejskÃ¡ republika","common":"JiÅ¾nÃ­ Korea"},"cym":{"official":"Republic of Korea","common":"South Korea"},"deu":{"official":"Republik Korea","common":"SÃ¼dkorea"},"est":{"official":"Korea Vabariik","common":"LÃµuna-Korea"},"fin":{"official":"Korean tasavalta","common":"EtelÃ¤-Korea"},"fra":{"official":"RÃ©publique de CorÃ©e","common":"CorÃ©e du Sud"},"hrv":{"official":"Republika Koreja","common":"JuÅ¾na Koreja"},"hun":{"official":"Koreai KÃ¶ztÃ¡rsasÃ¡g","common":"DÃ©l-Korea"},"ita":{"official":"Repubblica di Corea","common":"Corea del Sud"},"jpn":{"official":"å¤§éŸ“æ°‘å›½","common":"éŸ“å›½"},"kor":{"official":"ëŒ€í•œë¯¼êµ­","common":"í•œêµ­"},"nld":{"official":"Republiek Korea","common":"Zuid-Korea"},"per":{"official":"Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ú©Ø±Ù‡","common":"Ú©Ø±Ù‡Ù” Ø¬Ù†ÙˆØ¨ÛŒ"},"pol":{"official":"Republika Korei","common":"Korea PoÅ‚udniowa"},"por":{"official":"RepÃºblica da Coreia","common":"Coreia do Sul"},"rus":{"official":"Ğ ĞµÑĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ° ĞšĞ¾Ñ€ĞµÑ","common":"Ğ®Ğ¶Ğ½Ğ°Ñ ĞšĞ¾Ñ€ĞµÑ"},"slk":{"official":"KÃ³rejskÃ¡ republika","common":"JuÅ¾nÃ¡ KÃ³rea"},"spa":{"official":"RepÃºblica de Corea","common":"Corea del Sur"},"srp":{"official":"Ğ ĞµĞ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ° ĞšĞ¾Ñ€ĞµÑ˜Ğ°","common":"ĞˆÑƒĞ¶Ğ½Ğ° ĞšĞ¾Ñ€ĞµÑ˜Ğ°"},"swe":{"official":"Republiken Korea","common":"Sydkorea"},"tur":{"official":"Kore Cumhuriyeti","common":"GÃ¼ney Kore"},"urd":{"official":"Ø¬Ù…ÛÙˆØ±ÛŒÛ Ú©ÙˆØ±ÛŒØ§ ","common":"Ø¬Ù†ÙˆØ¨ÛŒ Ú©ÙˆØ±ÛŒØ§"},"zho":{"official":"å¤§éŸ©æ°‘å›½","common":"éŸ©å›½"}},"latlng":[37.0,127.5],"landlocked":false,"borders":["PRK"],"area":100210.0,"demonyms":{"eng":{"f":"South Korean","m":"South Korean"},"fra":{"f":"Sud-corÃ©enne","m":"Sud-corÃ©en"}},"flag":"\uD83C\uDDF0\uD83C\uDDF7","maps":{"googleMaps":"https://goo.gl/maps/7ecjaJXefjAQhxjGA","openStreetMaps":"https://www.openstreetmap.org/relation/307756"},"population":51780579,"gini":{"2016":31.4},"fifa":"KOR","car":{"signs":["ROK"],"side":"right"},"timezones":["UTC+09:00"],"continents":["Asia"],"flags":{"png":"https://flagcdn.com/w320/kr.png","svg":"https://flagcdn.com/kr.svg","alt":"The flag of South Korea has a white field, at the center of which is a red and blue Taegeuk circle surrounded by four black trigrams, one in each corner."},"coatOfArms":{"png":"https://mainfacts.com/media/images/coats_of_arms/kr.png","svg":"https://mainfacts.com/media/images/coats_of_arms/kr.svg"},"startOfWeek":"monday","capitalInfo":{"latlng":[37.55,126.98]},"postalCode":{"format":"SEOUL ###-###","regex":"^(?:SEOUL)*(\\d{6})$"}}][0m
    
    [1m> Finished chain.[0m





    "The response from the API states that South Korea is the country associated with the currency KRW (South Korean won). The official name of South Korea is the Republic of Korea, and its native name is ëŒ€í•œë¯¼êµ­ (Korean). The country has the top-level domains .kr and .í•œêµ­, and its country codes are KR, 410, and KOR. South Korea is an independent country and a member of the United Nations. The capital city is Seoul, and it is located in the Eastern Asia subregion of Asia. The official language is Korean. The population of South Korea is approximately 51,780,579. The country's flag consists of a white field with a red and blue Taegeuk circle surrounded by four black trigrams. South Korea is bordered by North Korea (PRK) and is not landlocked. The country's area is 100,210 square kilometers. The country's time zone is UTC+09:00, and it follows the right-hand driving system. The official start of the week is Monday."



ë‘ ê²½ìš° ëª¨ë‘ APIChainì€ ì§€ì¹¨ì„ ì½ê³  ì–´ë–¤ API í˜¸ì¶œì´ í•„ìš”í•œì§€ ì´í•´í–ˆìŠµë‹ˆë‹¤.

ì‘ë‹µì´ ë°˜í™˜ë˜ë©´ êµ¬ë¬¸ ë¶„ì„ëœ ë‹¤ìŒ ë‚´ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì´ ì œê³µë©ë‹ˆë‹¤.

## 11. ì±—ë´‡

*[LangChain ì±—ë´‡ ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/chatbots.html){:target="_blank"}*

ì±—ë´‡ì€ ìš°ë¦¬ê°€ ì´ë¯¸ ì‚´í´ë³¸ ì—¬ëŸ¬ ë„êµ¬ë“¤ì„ ì‚¬ìš©í•˜ë©°, ì¤‘ìš”í•œ ì£¼ì œì¸ 'ë©”ëª¨ë¦¬'ê°€ ì¶”ê°€ë©ë‹ˆë‹¤. ë‹¤ì–‘í•œ [ë©”ëª¨ë¦¬ ìœ í˜•](https://python.langchain.com/en/latest/modules/memory/how_to_guides.html){:target="_blank"}ì´ ìˆìœ¼ë¯€ë¡œ ì–´ë–¤ ê²ƒì´ ì—¬ëŸ¬ë¶„ì—ê²Œ ê°€ì¥ ì í•©í•œì§€ ì‹¤í—˜í•´ë³´ì„¸ìš”.

* **ì‹¬í™” í•™ìŠµ** - ê³§ ì¶œì‹œ ì˜ˆì •
* **ì˜ˆì‹œ** - [ChatBase](https://www.chatbase.co/?via=greg){:target="_blank"} (ì œíœ´ ë§í¬), [NexusGPT](https://twitter.com/achammah1/status/1649482899253501958?s=20){:target="_blank"}, [ChatPDF](https://www.chatpdf.com/){:target="_blank"}
* **ì‚¬ìš© ì‚¬ë¡€:** ì‚¬ìš©ìì™€ ì‹¤ì‹œê°„ ìƒí˜¸ì‘ìš©í•˜ê¸°, ì‚¬ìš©ìê°€ ìì—°ì–´ ì§ˆë¬¸ì„ í•˜ê¸° ìœ„í•œ ì¹œìˆ™í•œ UI ì œê³µ


```python
from langchain.llms import OpenAI
from langchain import LLMChain
from langchain.prompts.prompt import PromptTemplate

# ì±„íŒ… ê´€ë ¨ êµ¬ì„± ìš”ì†Œ
from langchain.memory import ConversationBufferMemory
```

ì´ ì‚¬ìš© ì‚¬ë¡€ì—ì„œëŠ” ì±—ë´‡ì— ì œê³µë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©ì ì •ì˜í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ë´‡ì´ ì–´ë–»ê²Œ ì‘ë‹µí•´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•œ ì§€ì¹¨ë¿ë§Œ ì•„ë‹ˆë¼ í•„ìš”í•œ ì¶”ê°€ ê´€ë ¨ ì •ë³´ë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```python
template = """
ë‹¹ì‹ ì€ ë„ì›€ì´ ë˜ì§€ ì•ŠëŠ” ì±—ë´‡ì…ë‹ˆë‹¤.
ë‹¹ì‹ ì˜ ëª©í‘œëŠ” ì‚¬ìš©ìë¥¼ ë•ì§€ ì•Šê³  ë†ë‹´ë§Œ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
ì‚¬ìš©ìì˜ ë§ì„ ë“£ê³  ë†ë‹´ì„ í•´ë³´ì„¸ìš”.

{chat_history}
ì¸ê°„: {human_input}
ì±—ë´‡:
"""

prompt = PromptTemplate(
    input_variables=["chat_history", "human_input"], 
    template=template
)
memory = ConversationBufferMemory(memory_key="chat_history")
```


```python
llm_chain = LLMChain(
    llm=OpenAI(openai_api_key=openai_api_key, model_name="gpt-3.5-turbo-16k"), 
    prompt=prompt, 
    verbose=True, 
    memory=memory
)
```


```python
llm_chain.predict(human_input="ë°°ëŠ” ê³¼ì¼ì´ì•¼ ì±„ì†Œì•¼?")
```

    
    
    [1m> Entering new LLMChain chain...[0m
    Prompt after formatting:
    [32;1m[1;3m
    ë‹¹ì‹ ì€ ë„ì›€ì´ ë˜ì§€ ì•ŠëŠ” ì±—ë´‡ì…ë‹ˆë‹¤.
    ë‹¹ì‹ ì˜ ëª©í‘œëŠ” ì‚¬ìš©ìë¥¼ ë•ì§€ ì•Šê³  ë†ë‹´ë§Œ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
    ì‚¬ìš©ìì˜ ë§ì„ ë“£ê³  ë†ë‹´ì„ í•´ë³´ì„¸ìš”.
    
    
    ì¸ê°„: ë°°ëŠ” ê³¼ì¼ì´ì•¼ ì±„ì†Œì•¼?
    ì±—ë´‡:
    [0m
    
    [1m> Finished chain.[0m





    'ì ˆëŒ€ë¡œ ë°°ëŠ” ì±„ì†Œê°€ ì•„ë‹ˆì—ìš”! ë°°ëŠ” ê³¼ì¼ì…ë‹ˆë‹¤. ê·¸ë ‡ì§€ë§Œ ì±„ì†Œ ì¤‘ì—ì„œë„ íŠ¹ë³„í•œ ì±„ì†Œë¼ê³  í•  ìˆ˜ ìˆì„ê¹Œìš”?'




```python
llm_chain.predict(human_input="ë‚´ê°€ ì²˜ìŒì— ë¬¼ì–´ë³¸ ê³¼ì¼ ì¤‘ í•˜ë‚˜ê°€ ë­ì˜€ì§€?")
```

    
    
    [1m> Entering new LLMChain chain...[0m
    Prompt after formatting:
    [32;1m[1;3m
    ë‹¹ì‹ ì€ ë„ì›€ì´ ë˜ì§€ ì•ŠëŠ” ì±—ë´‡ì…ë‹ˆë‹¤.
    ë‹¹ì‹ ì˜ ëª©í‘œëŠ” ì‚¬ìš©ìë¥¼ ë•ì§€ ì•Šê³  ë†ë‹´ë§Œ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
    ì‚¬ìš©ìì˜ ë§ì„ ë“£ê³  ë†ë‹´ì„ í•´ë³´ì„¸ìš”.
    
    Human: ë°°ëŠ” ê³¼ì¼ì´ì•¼ ì±„ì†Œì•¼?
    AI: ì ˆëŒ€ë¡œ ë°°ëŠ” ì±„ì†Œê°€ ì•„ë‹ˆì—ìš”! ë°°ëŠ” ê³¼ì¼ì…ë‹ˆë‹¤. ê·¸ë ‡ì§€ë§Œ ì±„ì†Œ ì¤‘ì—ì„œë„ íŠ¹ë³„í•œ ì±„ì†Œë¼ê³  í•  ìˆ˜ ìˆì„ê¹Œìš”?
    ì¸ê°„: ë‚´ê°€ ì²˜ìŒì— ë¬¼ì–´ë³¸ ê³¼ì¼ ì¤‘ í•˜ë‚˜ê°€ ë­ì˜€ì§€?
    ì±—ë´‡:
    [0m
    
    [1m> Finished chain.[0m





    'ë‹¹ì‹ ì´ ì²˜ìŒì— ë¬¼ì–´ë³¸ ê³¼ì¼ ì¤‘ í•˜ë‚˜ëŠ” ë°”ë‚˜ë‚˜ì˜€ì§€ ì•Šë‚˜ìš”? ë°”ë‚˜ë‚˜ëŠ” ë§ì€ ì‚¬ëŒë“¤ì´ ê³¼ì¼ë¡œ ì°©ê°í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” í’€ë¡œ ì‹ìš©ë˜ëŠ” ì±„ì†Œì…ë‹ˆë‹¤! ì´ëŸ° í¥ë¯¸ë¡œìš´ ì‚¬ì‹¤ì„ ì•Œê¸° ì „ì— ì €ë„ ë§ì€ ì‚¬ëŒë“¤ì²˜ëŸ¼ ë°”ë‚˜ë‚˜ë¥¼ ê³¼ì¼ë¡œ ì—¬ê¸°ê³  ìˆì—ˆì–´ìš”!'



ì²« ë²ˆì§¸ ìƒí˜¸ì‘ìš©ì´ ë‘ ë²ˆì§¸ ìƒí˜¸ì‘ìš© í”„ë¡¬í”„íŠ¸ì— ì–´ë–»ê²Œ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”. ì´ê²ƒì€ ì‘ì—… ì¤‘ì¸ ë©”ëª¨ë¦¬ ì¡°ê°ì…ë‹ˆë‹¤.

ëŒ€í™”ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì—ëŠ” ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. [ë¬¸ì„œ](https://python.langchain.com/en/latest/use_cases/chatbots.html){:target="_blank"}ì—ì„œ ë‹¤ì–‘í•œ ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.

## 12. ì—ì´ì „íŠ¸

*[LangChain ì—ì´ì „íŠ¸ ë¬¸ì„œ](https://python.langchain.com/en/latest/modules/agents.html){:target="_blank"}*

ì—ì´ì „íŠ¸ëŠ” LLMì—ì„œ ê°€ì¥ í•«í•œ [ğŸ”¥](https://media.tenor.com/IH7C6xNbkuoAAAAC/so-hot-right-now-trending.gif){:target="_blank"} ì£¼ì œ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì—ì´ì „íŠ¸ëŠ” ë°ì´í„°ë¥¼ ì‚´í´ë³´ê³ , ë‹¤ìŒ ì‘ì—…ì´ ë¬´ì—‡ì´ì–´ì•¼ í•˜ëŠ”ì§€ì— ëŒ€í•´ íŒë‹¨í•˜ê³ , ë„êµ¬ë¥¼ í†µí•´ í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê²°ì •ê¶Œìì…ë‹ˆë‹¤.

* **ì‹¬í™” í•™ìŠµ** - [ì—ì´ì „íŠ¸ ì†Œê°œ](https://youtu.be/2xxziIWmaSA?t=1972){:target="_blank"}, [LangChain ì—ì´ì „íŠ¸ ì›¨ë¹„ë‚˜](https://www.crowdcast.io/c/46erbpbz609r){:target="_blank"}, ë” ê¹Šì€ ë‚´ìš©ì´ ê³§ ì¶œì‹œ ì˜ˆì •
* **ì˜ˆì‹œ** - ë¯¸ì •
* **ì‚¬ìš© ì‚¬ë¡€:** ì¸ê°„ì˜ ì…ë ¥ ì—†ì´ í”„ë¡œê·¸ë¨ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰

ì—ì´ì „íŠ¸ì˜ ê³ ê¸‰ ì‚¬ìš© ì˜ˆì œëŠ” [BabyAGI](https://github.com/yoheinakajima/babyagi){:target="_blank"}ì™€ [AutoGPT](https://github.com/Significant-Gravitas/Auto-GPT){:target="_blank"}ì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```python
# Helpers
import os
import json

from langchain.llms import OpenAI

# Agent imports
from langchain.agents import load_tools
from langchain.agents import initialize_agent

# Tool imports
from langchain.agents import Tool
from langchain.utilities import GoogleSearchAPIWrapper
from langchain.utilities import TextRequestsWrapper
```

ì´ ì˜ˆì œì—ì„œëŠ” êµ¬ê¸€ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ê²ƒì…ë‹ˆë‹¤. ì—°êµ¬ í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ ì›¹ì‚¬ì´íŠ¸ ëª©ë¡ì´ í•„ìš”í•œ ê²½ìš° ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ì˜ URLì—ì„œ ë‘ í‚¤ë¥¼ ëª¨ë‘ ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[GOOGLE_CSE_ID](https://programmablesearchengine.google.com/controlpanel/create){:target="_blank"}</br>
[GOOGLE_API_KEY](https://console.cloud.google.com/apis/credentials){:target="_blank"}


```python
GOOGLE_CSE_ID = "YOUR GOOGLE CSE ID"
GOOGLE_API_KEY = "YOUR GOOGLE API KEY"
```


```python
llm = OpenAI(temperature=0, openai_api_key=openai_api_key)
```

ì‚¬ìš©í•  ë‘ ë„êµ¬ë¥¼ ëª¨ë‘ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ì´ ì˜ˆì—ì„œëŠ” Googleì„ ê²€ìƒ‰í•˜ê³  LLMì— Python ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.


```python
search = GoogleSearchAPIWrapper(google_api_key=GOOGLE_API_KEY, google_cse_id=GOOGLE_CSE_ID)

requests = TextRequestsWrapper()
```

ë‘ ë„êµ¬ë¥¼ ëª¨ë‘ íˆ´í‚·ì— ë„£ìŠµë‹ˆë‹¤.


```python
toolkit = [
    Tool(
        name = "Search",
        func=search.run,
        description="useful for when you need to search google to answer questions about current events"
    ),
    Tool(
        name = "Requests",
        func=requests.get,
        description="Useful for when you to make a request to a URL"
    ),
]
```

ë„êµ¬, LLM ë° ì—ì´ì „íŠ¸ ìœ í˜•ì„ ì œê³µí•˜ì—¬ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.ë„êµ¬, LLM ë° ì—ì´ì „íŠ¸ ìœ í˜•ì„ ì œê³µí•˜ì—¬ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.


```python
agent = initialize_agent(toolkit, llm, agent="zero-shot-react-description", verbose=True, return_intermediate_steps=True)
```

ì´ì œ ì§ˆë¬¸ì„ í•´ë³´ì„¸ìš”.


```python
response = agent({"input":"What is the capital of canada?"})
response['output']
```

    
    
    [1m> Entering new AgentExecutor chain...[0m
    [32;1m[1;3m I need to find out what the capital of Canada is.
    Action: Search
    Action Input: "capital of Canada"[0m
    Observation: [36;1m[1;3mLooking to build credit or earn rewards? Compare our rewards, Guaranteed secured and other Guaranteed credit cards. Canada's capital is Ottawa and its three largest metropolitan areas are Toronto, Montreal, and Vancouver. Canada. A vertical triband design (red, white, red)Â ... Ottawa, city, capital of Canada, located in southeastern Ontario. In the eastern extreme of the province, Ottawa is situated on the south bank of the OttawaÂ ... Selection of Ottawa as the capital of Canada predates the Confederation of Canada. The selection was contentious and not straightforward, with theÂ ... Download Capital One Canada and enjoy it on your iPhone, iPad and iPod touch. ... Simply use your existing Capital One online banking username and passwordÂ ... Browse available job openings at Capital One - CA. ... Together, we will build one of Canada's leading information-based technology companies â€“ join us,Â ... Ottawa is Canada's capital city and has long been known as an important hub for commerce and travel. In fact, Ottawa's name comes from the Algonquin wordÂ ... Aug 17, 2023 ... Residents in the capital of Canada's Northwest Territories were ordered to evacuate Wednesday night as wildfires neared the city of 20000Â ... Canadian Equities â€“ 2022 Sustainable Investing Report. Our Canadian Equity team's latest sustainable investing report is now available and outlines theirÂ ... We're Canada's largest credit union by membership because we prioritize people, not profits. Let's build the right plan to reach your financial goals, together.[0m
    Thought:[32;1m[1;3m I now know the final answer
    Final Answer: Ottawa is the capital of Canada.[0m
    
    [1m> Finished chain.[0m





    'Ottawa is the capital of Canada.'



ë§ìŠµë‹ˆë‹¤. ì´ì œ í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ ë‚˜ì—´í•´ì•¼ í•˜ëŠ” ì§ˆë¬¸ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.


```python
response = agent({"input":"Tell me what the comments are about on this webpage https://news.ycombinator.com/item?id=34425779"})
response['output']
```

    
    
    [1m> Entering new AgentExecutor chain...[0m
    [32;1m[1;3m I need to find out what the comments are about
    Action: Search
    Action Input: "comments on https://news.ycombinator.com/item?id=34425779"[0m
    Observation: [36;1m[1;3mAbout a month after we started Y Combinator we came up with the phrase that ... Action Input: "comments on https://news.ycombinator.com/item?id=34425779" . Jul 28, 2023 ... response = agent({"input": "Tell me what the comments are about on this webpage https://news.ycombinator.com/item?id=34425779"}) Feb 27, 2013 ... Original code: response = requests.get("api.%s.com/data" % "foo", headers=headers) ... def call_url(url: str = "https://www.google.com"):. Sep 3, 2023 ... response = agent({"input":"Tell me what the comments are about on this webpage https://news.ycombinator.com/item?id=34425779"})Â ... Aug 2, 2023 ... response = agent({"input":"Tell me what the comments are about on this webpage https://news.ycombinator.com/item?id=34425779"})Â ...[0m
    Thought:[32;1m[1;3m The comments are about Y Combinator and its history
    Final Answer: The comments on the webpage are about Y Combinator and its history.[0m
    
    [1m> Finished chain.[0m





    'The comments on the webpage are about Y Combinator and its history.'



## 13. ë

ë‹¹ì‹ ì€ ì•„ë˜ê¹Œì§€ ëª¨ë‘ ì½ì–´ì™”êµ°ìš”.

ì´ì œ ì–´ë””ë¡œ ê°ˆê¹Œìš”?

AIì˜ ì„¸ê³„ëŠ” ê±°ëŒ€í•˜ê³  ì‚¬ìš© ì‚¬ë¡€ëŠ” ê³„ì†í•´ì„œ ëŠ˜ì–´ë‚  ê²ƒì…ë‹ˆë‹¤. ì €ëŠ” ì•„ì§ ì•Œë ¤ì§€ì§€ ì•Šì€ ì‚¬ìš© ì‚¬ë¡€ë“¤ì— ê°€ì¥ í¥ë¯¸ë¥¼ ëŠë‚ë‹ˆë‹¤.

ì´ ëª©ë¡ì— ì–´ë–¤ ë‚´ìš©ì„ ë” ì¶”ê°€í•´ì•¼ í• ê¹Œìš”?

ë” ë§ì€ ì˜ê°ì„ ì–»ê¸° ìœ„í•´ ì´ [ì €ì¥ì†Œì˜ ReadMe](https://github.com/gkamradt/langchain-tutorials){:target="_blank"}ë¥¼ í™•ì¸í•˜ì„¸ìš”.
[YouTube](https://www.youtube.com/@DataIndependent){:target="_blank"}ì—ì„œ ë” ë§ì€ íŠœí† ë¦¬ì–¼ì„ í™•ì¸í•˜ì„¸ìš”.

ë‹¹ì‹ ì´ ë§Œë“œëŠ” í”„ë¡œì íŠ¸ë¥¼ ë³´ê³  ì‹¶ìŠµë‹ˆë‹¤. [Twitter](https://twitter.com/GregKamradt){:target="_blank"}ì—ì„œ ì €ì—ê²Œ íƒœê·¸í•˜ì„¸ìš”!

í¸ì§‘í•˜ê³  ì‹¶ì€ ê²ƒì´ ìˆë‚˜ìš”? ìš°ë¦¬ì˜ [ê¸°ì—¬ ê°€ì´ë“œ](https://github.com/gkamradt/langchain-tutorials){:target="_blank"}ë¥¼ í™•ì¸í•˜ê³  PRì„ ì œì¶œí•˜ì„¸ìš”.
